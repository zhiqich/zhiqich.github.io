<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Zhiqi Chen</title>
  <icon>http://yoursite.com/icon.png</icon>
  <subtitle>Story</subtitle>
  <link href="http://yoursite.com/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2021-03-19T03:38:32.912Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>Zhiqi Chen</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>IP Tracking Test</title>
    <link href="http://yoursite.com/2021/03/18/iptrackingtest/"/>
    <id>http://yoursite.com/2021/03/18/iptrackingtest/</id>
    <published>2021-03-19T03:37:34.000Z</published>
    <updated>2021-03-19T03:38:32.912Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">xxxx-xx-xx</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="0a18f1cefbabbe2d8eadd97e340b6c27737f60819ed193ada84b41b3a6a87852">b17b4b4bd00683c277c0e15f1587c5395ce7cb107fecc795b52333a94eb85715093ca54479d31827359c1a3e44356c1e4d02d17b2ebdcc21c485456a7057ce396347d3cf61906bd9daff988ba3aa897498f18f591a4467463ad7b231a49944ea150579b9dc1e890334954281e038530dc850dedcaf4f0692f6440d09e7aa2e9966381ec5ae72e57399a4c5aa11c9738513de975cb970bd767cc1eafdab7ecbec5ba640162ddccd064477ba06452774b071dc001ca8a049a11716707a690b9fb10cee69d9c488b90c4d0d7de72b512ae705186e23e3f73ebbe88112ecd290d10146d58b171170b03abece8ea8af97e5cb72f9a656d035b9d15f84d3bf1549497299c0e815596515576e9acaaa3fa2705bb69b981c3458fff9c5d2ab618012f83197308c46abdc7b37d7ee3aa0d290deac16347517273ce9f2b53286ca69d964e08ce3d3fe70ed7c673e6e08b27d9b07e7</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">Here&#39;s something encrypted, password is required to continue reading.</summary>
    
    
    
    <category term="project" scheme="http://yoursite.com/categories/project/"/>
    
    
  </entry>
  
  <entry>
    <title>Learning Configuring Spark Jobs</title>
    <link href="http://yoursite.com/2021/03/18/spark/"/>
    <id>http://yoursite.com/2021/03/18/spark/</id>
    <published>2021-03-19T03:26:49.000Z</published>
    <updated>2021-03-19T03:42:20.371Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h2><p>Go to official Apache Spark download <a href="https://spark.apache.org/downloads.html" target="_blank" rel="noopener">webpage</a> and select Spark release version 3.1.1 and package type Source Code. Unzip the downloaded package and build Spark by Apache Maven.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./build/mvn -DskipTests clean package</span><br></pre></td></tr></table></figure><h2 id="Example-Programs"><a href="#Example-Programs" class="headerlink" title="Example Programs"></a>Example Programs</h2><h3 id="SparkPi"><a href="#SparkPi" class="headerlink" title="SparkPi"></a>SparkPi</h3><p>SparkPi is a compute-intensive task which estimates <code>pi</code> by “throwing darts” at a circle. Random points in the unit square ((0, 0) to (1,1)) are picked and we can see how many fall in the unit circle. The fraction should be <code>pi/4</code>, so we use this to get the estimate.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Usage: pi [partitions]</span></span><br><span class="line">./bin/run-example SparkPi 10/1000/10000</span><br></pre></td></tr></table></figure><p>For 10 partitions, the <code>pi</code> estimation is roughly 3.1392951, and the running time is 0.496385s. For 100 partitions, the <code>pi</code> estimation is roughly 3.1413819, and the running time is 3.576282s. For 1000 partitions, the <code>pi</code> estimation is roughly 3.1416965, and the running time is 43.483414s. For 10000 partitions, the <code>pi</code> estimation is roughly 3.1415915, and the running time is 363.989005s.<br>|Partition|Running Time|Result   |<br>|———|————|———|<br>|10       |0.496s      |3.1392951|<br>|100      |3.576s      |3.1413819|<br>|1000     |43.483s     |3.1416965|<br>|10000    |363.989s    |3.1415915|</p><h3 id="WordCount"><a href="#WordCount" class="headerlink" title="WordCount"></a>WordCount</h3><h4 id="Dataset"><a href="#Dataset" class="headerlink" title="Dataset"></a>Dataset</h4><h5 id="Gutenberg"><a href="#Gutenberg" class="headerlink" title="Gutenberg"></a>Gutenberg</h5><p>To get big quantities of text without repetition, I crawl text files from Project Gutenberg.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Create directory</span></span><br><span class="line">mkdir Download/temp/</span><br><span class="line">cd Download/temp/</span><br><span class="line"><span class="meta">#</span><span class="bash"> Crawl text files</span></span><br><span class="line">wget -bqc -w 2 -m -H 'http://www.gutenberg.org/robot/harvest?filetypes[]=txt&amp;langs[]=en'</span><br><span class="line"><span class="meta">#</span><span class="bash"> Extract text data</span></span><br><span class="line">mkdir extracted/</span><br><span class="line">find . -name '*.zip' -exec sh -c 'unzip -d extracted &#123;&#125;' ';'</span><br><span class="line">cat extracted/*.txt &gt; temp.txt</span><br></pre></td></tr></table></figure><p>After crawling text data, remove special characters from the text file and fix encoding.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">string = open(<span class="string">'temp.txt'</span>, encoding = <span class="string">"ISO-8859-1"</span>).read()</span><br><span class="line">new_str = re.sub(<span class="string">'[^a-zA-Z0-9\n\.]'</span>, <span class="string">' '</span>, string)</span><br><span class="line">open(<span class="string">'gutenberg.txt'</span>, <span class="string">'w'</span>).write(new_str)</span><br></pre></td></tr></table></figure><h5 id="Yelp"><a href="#Yelp" class="headerlink" title="Yelp"></a>Yelp</h5><p>Download Yelp <a href="https://www.yelp.com/dataset" target="_blank" rel="noopener">dataset</a>. I will focus on the review dataset which contains big quantities of text without repetition and can work as a benchmark. Before I run the example program on the dataset, I first need to convert the JSON file into a CSV file. Since the dataset is too large, I will process the first 1000000 reviews which is almost 6GB.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">review_json_path = <span class="string">'yelp_academic_dataset_review.json'</span></span><br><span class="line">size = <span class="number">1000000</span></span><br><span class="line">review = pd.read_json(review_json_path, lines=<span class="literal">True</span>, dtype=&#123;<span class="string">'review_id'</span>: str, <span class="string">'user_id'</span>: str, <span class="string">'business_id'</span>: str,</span><br><span class="line">                      <span class="string">'stars'</span>: int, <span class="string">'date'</span>: str, <span class="string">'text'</span>: str, <span class="string">'useful'</span>: int, <span class="string">'funny'</span>: int, <span class="string">'cool'</span>: int&#125;, chunksize=size)</span><br><span class="line">chunk_list = []</span><br><span class="line"><span class="keyword">for</span> chunk_review <span class="keyword">in</span> review:</span><br><span class="line">    chunk_review = chunk_review.drop(</span><br><span class="line">        [<span class="string">'review_id'</span>, <span class="string">'user_id'</span>, <span class="string">'business_id'</span>, <span class="string">'stars'</span>, <span class="string">'date'</span>, <span class="string">'useful'</span>, <span class="string">'funny'</span>, <span class="string">'cool'</span>], axis=<span class="number">1</span>)</span><br><span class="line">    chunk_list.append(chunk_review)</span><br><span class="line">df = pd.concat(chunk_list, ignore_index=<span class="literal">True</span>, join=<span class="string">'outer'</span>, axis=<span class="number">0</span>)</span><br><span class="line">csv_name = <span class="string">"result.csv"</span></span><br><span class="line">df.to_csv(csv_name, index=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><p>After getting the CSV file, I also need to clean the data by removing special characters.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">string = open(<span class="string">'yelp.csv'</span>).read()</span><br><span class="line">new_str = re.sub(<span class="string">'[^a-zA-Z0-9\n]'</span>, <span class="string">' '</span>, string)</span><br><span class="line">open(<span class="string">'result.txt'</span>, <span class="string">'w'</span>).write(new_str)</span><br></pre></td></tr></table></figure><h4 id="Result"><a href="#Result" class="headerlink" title="Result"></a>Result</h4><h5 id="Gutenberg-1"><a href="#Gutenberg-1" class="headerlink" title="Gutenberg"></a>Gutenberg</h5><p>Run the following command to count words in the dataset.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">time ./bin/spark-submit examples/src/main/python/wordcount.py ../gutenberg.txt</span><br></pre></td></tr></table></figure><p>The total running time is 0m6.037s.</p><h5 id="Yelp-1"><a href="#Yelp-1" class="headerlink" title="Yelp"></a>Yelp</h5><p>Run the following command to count words in the dataset.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">time ./bin/spark-submit examples/src/main/python/wordcount.py ../yelp.txt</span><br></pre></td></tr></table></figure><p>The total running time is 1m56.498s.</p><h2 id="Configuration-Impact"><a href="#Configuration-Impact" class="headerlink" title="Configuration Impact"></a>Configuration Impact</h2><p>I choose to run an example MapReduce program sort to see the configuration impact.</p><h3 id="Bug-Fix"><a href="#Bug-Fix" class="headerlink" title="Bug Fix"></a>Bug Fix</h3><p>The provided python code for the sort program has a bug in line 35. Fix it by removing the translation from string to int.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sortedCount = lines.flatMap(<span class="keyword">lambda</span> x: x.split(<span class="string">' '</span>)) \</span><br><span class="line">    .map(<span class="keyword">lambda</span> x: (x, <span class="number">1</span>)) \</span><br><span class="line">    .sortByKey()</span><br></pre></td></tr></table></figure><h3 id="Dataset-Preparation"><a href="#Dataset-Preparation" class="headerlink" title="Dataset Preparation"></a>Dataset Preparation</h3><p>I will use the Yelp dataset as a benchmark to see the impact configuration. However, since the Yelp dataset I use in the previous section is too large (&gt;5GB), the sort program will always report buffer overflow. So, I will only run the first 500MB dataset (xaa).</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">split -b 500m yelp.txt</span><br></pre></td></tr></table></figure><h3 id="Configuration-File"><a href="#Configuration-File" class="headerlink" title="Configuration File"></a>Configuration File</h3><p>The configuration file of Spark is provided as a template <code>spark-defaults.conf.template</code>. To modify the configuration, first copy the template and change the name to <code>spark-defaults.conf</code>, then I can change the settings by adding properties in this file.</p><h3 id="Driver-Memory"><a href="#Driver-Memory" class="headerlink" title="Driver Memory"></a>Driver Memory</h3><p>The first change in the configuration is <code>spark.driver.memory</code> and <code>spark.driver.maxResultSize</code>. The <code>spark.driver.maxResultSize</code> is set to 10G which is larger than the size of the dataset to ensure the serialization can complete. The driver memory is the amount of memory to use for the driver process. I have tested four values for the driver memory: 1G, 2G, 4G and 8G. The program can run by two commands.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">set</span> config directly <span class="keyword">in</span> <span class="built_in">command</span> line</span></span><br><span class="line">time ./bin/spark-submit --driver-memory 1g examples/src/main/python/sort.py ../xaa</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">set</span> config <span class="keyword">in</span> config file</span></span><br><span class="line">time ./bin/spark-submit --properties-file conf/spark-defaults.conf examples/src/main/python/sort.py ../xaa</span><br></pre></td></tr></table></figure><h4 id="1G"><a href="#1G" class="headerlink" title="1G"></a>1G</h4><p>The Spark default value of driver memory is 1G. However, it’s too small for the testing dataset and the sort program will report Java heap space out of memory.</p><h4 id="2G"><a href="#2G" class="headerlink" title="2G"></a>2G</h4><p>After raising the driver memory to 2G, the sort program will still report Java heap space out of memory.</p><h4 id="4G"><a href="#4G" class="headerlink" title="4G"></a>4G</h4><p>The sort program will run successfully when the driver memory is raised to 4G. The program can correctly print out the sorted words and the total running time is 3m47.166s (including the printing time).</p><h4 id="8G"><a href="#8G" class="headerlink" title="8G"></a>8G</h4><p>The program can correctly print out the sorted words and the total running time is 3m47.200s (including the printing time), which is similar to 4G.</p><h4 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h4><table><thead><tr><th>Driver Memory</th><th>Running Time</th></tr></thead><tbody><tr><td>1G</td><td>NA</td></tr><tr><td>2G</td><td>NA</td></tr><tr><td>4G</td><td>3m47.166s</td></tr><tr><td>8G</td><td>3m47.200s</td></tr><tr><td>### Reducer Size</td><td></td></tr><tr><td>The second property to modify is the <code>spark.reducer.maxSizeInFlight</code>. It is the maximum size of map outputs to fetch simultaneously from each reduce task. It represents a fixed memory overhead per reduce task. I would like to see if the fetch size will impact the performance. I will try three sizes: 12M, 48M, and 96M. The <code>spark.reducer.maxSizeInFlight</code> will be added to the property file and the program will run by the following command.</td><td></td></tr><tr><td><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">time ./bin/spark-submit --properties-file conf/spark-defaults.conf examples/src/main/python/sort.py ../xaa</span><br></pre></td></tr></table></figure></td><td></td></tr><tr><td>#### 12M</td><td></td></tr><tr><td>The running time with 12M fetching size is 3m58.065s including the result printing time.</td><td></td></tr><tr><td>#### 48M</td><td></td></tr><tr><td>The Spark default reducer max size in flight is 48M. The running time with 12M fetching size is 4m0.725s including the result printing time.</td><td></td></tr><tr><td>#### 96M</td><td></td></tr><tr><td>The running time with 12M fetching size is 3m56.303s including the result printing time.</td><td></td></tr><tr><td>#### Summary</td><td></td></tr><tr><td>Reducer Size</td><td>Running Time</td></tr><tr><td>————</td><td>————</td></tr><tr><td>12M</td><td>3m58.065s</td></tr><tr><td>48M</td><td>4m0.725s</td></tr><tr><td>96M</td><td>3m56.303s</td></tr><tr><td>### Shuffle Buffer</td><td></td></tr><tr><td>The third property to change is the <code>spark.shuffle.file.buffer</code>. It is the size of the in-memory buffer for each shuffle file output stream. The buffers can reduce the number of disk seeks and system calls made in creating intermediate shuffle files so that larger buffers can theoretically result in better performance. I will try three different buffer sizes: 8K, 32K, and 1M. The following is the running command.</td><td></td></tr><tr><td><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">time ./bin/spark-submit --properties-file conf/spark-defaults.conf examples/src/main/python/sort.py ../xaa</span><br></pre></td></tr></table></figure></td><td></td></tr><tr><td>#### 8K</td><td></td></tr><tr><td>The running time for 8K shuffle buffer is 3m55.807s including result printing time.</td><td></td></tr><tr><td>#### 32K</td><td></td></tr><tr><td>32K is the Spark default value for shuffle file buffer. The running time for 8K shuffle buffer is 3m59.308s including result printing time.</td><td></td></tr><tr><td>#### 1M</td><td></td></tr><tr><td>The running time for 8K shuffle buffer is 3m59.725s including result printing time.</td><td></td></tr><tr><td>#### Summary</td><td></td></tr><tr><td>Shuffle Buffer</td><td>Running Time</td></tr><tr><td>————–</td><td>————</td></tr><tr><td>8K</td><td>3m55.807s</td></tr><tr><td>32M</td><td>3m59.308s</td></tr><tr><td>1M</td><td>3m59.725s</td></tr><tr><td>### Serializer</td><td></td></tr><tr><td>The fourth property to change is the <code>spark.serializer</code>. It is the class to use for serializing objects that will be sent over the network or need to be cached in serialized form. It is said that the default serializer <code>JavaSerializer</code> doesn’t perform well enough. I will try two different buffer sizes: default one and <code>KryoSerializer</code>. The following is the running command.</td><td></td></tr><tr><td><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">time ./bin/spark-submit --properties-file conf/spark-defaults.conf examples/src/main/python/sort.py ../xaa</span><br></pre></td></tr></table></figure></td><td></td></tr><tr><td>#### JavaSerializer</td><td></td></tr><tr><td>The running time without printing out results for default serializer is 6.6012s.</td><td></td></tr><tr><td>#### KryoSerializer</td><td></td></tr><tr><td>The running time without printing out results for default serializer is 6.5324s. In order to run the program without buffer overflow, I set the <code>spark.kryoserializer.buffer.max</code> to 2047M.</td><td></td></tr><tr><td>#### Summary</td><td></td></tr><tr><td>Serializer</td><td>Running Time</td></tr><tr><td>————–</td><td>————</td></tr><tr><td>JavaSerializer</td><td>6.6012s</td></tr><tr><td>KryoSerializer</td><td>6.5324s</td></tr><tr><td>### Thread Number</td><td></td></tr><tr><td>Since I am running Spark on local mode, I can’t control how many cores the program uses to run the benchmark, but I can set how many threads the local program is running on within the limit of the number of logical cores of the device. I have tried five different thread number: 1, 2, 4, 8 and 12. The default thread number is 2. The following is the command running the program.</td><td></td></tr><tr><td><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">time ./bin/spark-submit --master local[1] --properties-file conf/spark-defaults.conf examples/src/main/python/sort.py ../xaa</span><br></pre></td></tr></table></figure></td><td></td></tr><tr><td>#### Summary</td><td></td></tr><tr><td>Thread Number</td><td>Running Time</td></tr><tr><td>————–</td><td>————</td></tr><tr><td>1</td><td>32.909s</td></tr><tr><td>2</td><td>18.484s</td></tr><tr><td>4</td><td>9.565s</td></tr><tr><td>8</td><td>7.100s</td></tr><tr><td>12</td><td>6.570s</td></tr></tbody></table>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;</summary>
        
      
    
    
    
    <category term="project" scheme="http://yoursite.com/categories/project/"/>
    
    
  </entry>
  
  <entry>
    <title>10</title>
    <link href="http://yoursite.com/2021/03/08/10/"/>
    <id>http://yoursite.com/2021/03/08/10/</id>
    <published>2021-03-08T05:01:02.000Z</published>
    <updated>2021-03-11T04:30:11.290Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">xxxx-xx-xx</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="08c4383f81aabf7f2ad76c3911a140c8f47fed8b377618088307c89a982878f8">6020494628938368b538a266ca434817475c19f11e3bfc8c0adee9e2b733526eab669af2446b9ce94d8c595dfce72e7a3bb984c37059fdbf0448c0184be1a96dc5a4897ea05c2c4d2756fe5086d845107c72b7ca41e6c2e433f4389d8a506cba3167d2dedf18a20040012f16c7635df748e63515a4811d65b0d4577f0bdabafe2743f3c61c75174d644e1197dfb27eb671e0bb4572e77aab5a76d2c60cb3f2fadbf3f8cc603a3188e5950fb06aa333d63a0b87391eb5b689383bc65977ef62cfbaf657950ba814fc5c6ca5d30a26ac709fabd9484c3cc055f9230535aa2d6184</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">Here&#39;s something encrypted, password is required to continue reading.</summary>
    
    
    
    <category term="raving" scheme="http://yoursite.com/categories/raving/"/>
    
    
  </entry>
  
  <entry>
    <title>Hyperledger Fabric</title>
    <link href="http://yoursite.com/2021/03/06/hyperledgerfabric/"/>
    <id>http://yoursite.com/2021/03/06/hyperledgerfabric/</id>
    <published>2021-03-06T23:27:26.000Z</published>
    <updated>2021-03-06T23:29:03.594Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>Hyperledger Fabric is an open source enterprise-grade permissioned distributed ledger technology (DLT) platform, designed for use in enterprise contexts. It is the first distributed ledger platform to support smart contracts authored in general-purpose programming languages such as Java, Go and Node.js, rather than constrained domain-specific languages (DSL).</p><h2 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h2><h3 id="Prerequisite"><a href="#Prerequisite" class="headerlink" title="Prerequisite"></a>Prerequisite</h3><h4 id="Update"><a href="#Update" class="headerlink" title="Update"></a>Update</h4><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt upgrade</span><br></pre></td></tr></table></figure><h4 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h4><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install git</span><br></pre></td></tr></table></figure><h4 id="cURL"><a href="#cURL" class="headerlink" title="cURL"></a>cURL</h4><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install curl</span><br></pre></td></tr></table></figure><h4 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h4><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get -y install docker-compose</span><br></pre></td></tr></table></figure><p>Confirm installation and version.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">zhiqich@ubuntu:~$ docker --version</span><br><span class="line">Docker version 19.03.8, build afacb8b7f0</span><br><span class="line">zhiqich@ubuntu:~$ docker-compose --version</span><br><span class="line">docker-compose version 1.25.0, build unknown</span><br></pre></td></tr></table></figure><p>Start Docker daemon and add user to Docker group.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start docker</span><br><span class="line">sudo systemctl enable docker</span><br><span class="line">sudo usermod -a -G docker zhiqich</span><br></pre></td></tr></table></figure><h4 id="Optional-Go"><a href="#Optional-Go" class="headerlink" title="(Optional) Go"></a>(Optional) Go</h4><p><a href="https://golang.org/dl/go1.16.linux-amd64.tar.gz" target="_blank" rel="noopener">Download</a> Linux Go installer from Go official webpage.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://golang.org/dl/go1.16.linux-amd64.tar.gz</span><br></pre></td></tr></table></figure><p>Extract package into <code>/usr/local</code> (or other location such as <code>$HOME</code>) and create a Go tree.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo tar -C /usr/local -xzf go1.16.linux-amd64.tar.gz</span><br></pre></td></tr></table></figure><p>Add <code>/usr/local/go/bin</code> to the <code>PATH</code> environment variable.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim $HOME/.profile</span><br><span class="line">export PATH=$PATH:/usr/local/go/bin</span><br></pre></td></tr></table></figure><p>Apply change and confirm installation.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">source $HOME/.profile</span><br><span class="line">go version</span><br></pre></td></tr></table></figure><h4 id="Optional-JQ"><a href="#Optional-JQ" class="headerlink" title="(Optional) JQ"></a>(Optional) JQ</h4><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install jq</span><br></pre></td></tr></table></figure><h3 id="Fabric-Sample"><a href="#Fabric-Sample" class="headerlink" title="Fabric Sample"></a>Fabric Sample</h3><p>Download <code>fabric-samples</code> and related Docker images and binaries.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -sSL https://bit.ly/2ysbOFE | bash -s</span><br></pre></td></tr></table></figure><p>If Go language is preferred, install Fabric under Go directory, or set GOPATH to Go workspace.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p $HOME/go/src/github.com/zhiqich</span><br><span class="line">cd $HOME/go/src/github.com/zhiqich</span><br></pre></td></tr></table></figure><h3 id="Fabric-Application-SDK"><a href="#Fabric-Application-SDK" class="headerlink" title="Fabric Application SDK"></a>Fabric Application SDK</h3><h4 id="Node-js"><a href="#Node-js" class="headerlink" title="Node.js"></a>Node.js</h4><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install nodejs</span><br><span class="line">sudo apt install npm</span><br></pre></td></tr></table></figure><h4 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h4><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install openjdk-8-jre-headless</span><br></pre></td></tr></table></figure><h2 id="Run-Fabric"><a href="#Run-Fabric" class="headerlink" title="Run Fabric"></a>Run Fabric</h2><h3 id="Test-Network"><a href="#Test-Network" class="headerlink" title="Test Network"></a>Test Network</h3><h4 id="Bring-Up-Test-Network"><a href="#Bring-Up-Test-Network" class="headerlink" title="Bring Up Test Network"></a>Bring Up Test Network</h4><p>Annotated script <code>network.sh</code> in directory <code>test-network</code> stands up a Fabric network using Docker images.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd fabric-samples/test-network</span><br><span class="line">./network.sh -h</span><br></pre></td></tr></table></figure><p>Usage of <code>network.sh</code>.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">Usage: </span><br><span class="line">  network.sh &lt;Mode&gt; [Flags]</span><br><span class="line">    Modes:</span><br><span class="line">      up - Bring up Fabric orderer and peer nodes. No channel is created</span><br><span class="line">      up createChannel - Bring up fabric network with one channel</span><br><span class="line">      createChannel - Create and join a channel after the network is created</span><br><span class="line">      deployCC - Deploy a chaincode to a channel (defaults to asset-transfer-basic)</span><br><span class="line">      down - Bring down the network</span><br><span class="line"></span><br><span class="line">    Flags:</span><br><span class="line">    Used with network.sh up, network.sh createChannel:</span><br><span class="line">    -ca &lt;use CAs&gt; -  Use Certificate Authorities to generate network crypto material</span><br><span class="line">    -c &lt;channel name&gt; - Name of channel to create (defaults to "mychannel")</span><br><span class="line">    -s &lt;dbtype&gt; - Peer state database to deploy: goleveldb (default) or couchdb</span><br><span class="line">    -r &lt;max retry&gt; - CLI times out after certain number of attempts (defaults to 5)</span><br><span class="line">    -d &lt;delay&gt; - CLI delays for a certain number of seconds (defaults to 3)</span><br><span class="line">    -verbose - Verbose mode</span><br><span class="line"></span><br><span class="line">    Used with network.sh deployCC</span><br><span class="line">    -c &lt;channel name&gt; - Name of channel to deploy chaincode to</span><br><span class="line">    -ccn &lt;name&gt; - Chaincode name.</span><br><span class="line">    -ccl &lt;language&gt; - Programming language of the chaincode to deploy: go, java, javascript, typescript</span><br><span class="line">    -ccv &lt;version&gt;  - Chaincode version. 1.0 (default), v2, version3.x, etc</span><br><span class="line">    -ccs &lt;sequence&gt;  - Chaincode definition sequence. Must be an integer, 1 (default), 2, 3, etc</span><br><span class="line">    -ccp &lt;path&gt;  - File path to the chaincode.</span><br><span class="line">    -ccep &lt;policy&gt;  - (Optional) Chaincode endorsement policy using signature policy syntax. The default policy requires an endorsement from Org1 and Org2</span><br><span class="line">    -cccg &lt;collection-config&gt;  - (Optional) File path to private data collections configuration file</span><br><span class="line">    -cci &lt;fcn name&gt;  - (Optional) Name of chaincode initialization function. When a function is provided, the execution of init will be requested and the function will be invoked.</span><br><span class="line"></span><br><span class="line">    -h - Print this message</span><br><span class="line"></span><br><span class="line"> Possible Mode and flag combinations</span><br><span class="line">   up -ca -r -d -s -verbose</span><br><span class="line">   up createChannel -ca -c -r -d -s -verbose</span><br><span class="line">   createChannel -c -r -d -verbose</span><br><span class="line">   deployCC -ccn -ccl -ccv -ccs -ccp -cci -r -d -verbose</span><br><span class="line"></span><br><span class="line"> Examples:</span><br><span class="line">   network.sh up createChannel -ca -c mychannel -s couchdb</span><br><span class="line">   network.sh createChannel -c channelName</span><br><span class="line">   network.sh deployCC -ccn basic -ccp ../asset-transfer-basic/chaincode-javascript/ -ccl javascript</span><br><span class="line">   network.sh deployCC -ccn mychaincode -ccp ./user/mychaincode -ccv 1 -ccl javascript</span><br></pre></td></tr></table></figure><p>Turn down and remove any container or artifact from previous runs. Then bring up new network.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./network.sh down</span><br><span class="line">./network.sh up</span><br></pre></td></tr></table></figure><p>Bring up network with certificate authorities by flag <code>-ca</code>.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./network.sh up -ca</span><br></pre></td></tr></table></figure><p>Check running Docker containers and components of test network.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a</span><br></pre></td></tr></table></figure><h4 id="Create-Channel"><a href="#Create-Channel" class="headerlink" title="Create Channel"></a>Create Channel</h4><p>Create channel with default name of <code>mychannel</code>.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./network.sh createChannel</span><br></pre></td></tr></table></figure><p>Create channel with custom name by flag <code>-c</code>.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./network.sh createChannel -c channel</span><br></pre></td></tr></table></figure><h4 id="Start-Chaincode"><a href="#Start-Chaincode" class="headerlink" title="Start Chaincode"></a>Start Chaincode</h4><p>Start a chain code on channel through preferred SDK (Java, Go, Javascript).</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./network.sh deployCC -ccn basic -ccp ../asset-transfer-basic/chaincode-go -ccl go</span><br></pre></td></tr></table></figure><h3 id="Fabric-Application"><a href="#Fabric-Application" class="headerlink" title="Fabric Application"></a>Fabric Application</h3><h4 id="Introduction-1"><a href="#Introduction-1" class="headerlink" title="Introduction"></a>Introduction</h4><p>The tutorial provides an introduction to how Fabric applications interact with deployed blockchain networks. It uses sample programs built using Fabric SDK to invoke a smart contract which queries and updates the ledger with smart contract API. It also uses sample programs and a deployed Certificate Authority to generate X.509 certificates that an application needs to interact with a permissioned blockchain.</p><h4 id="Asset-Transfer"><a href="#Asset-Transfer" class="headerlink" title="Asset Transfer"></a>Asset Transfer</h4><p>Asset Transfer basic sample demonstrates how to initialize a ledger with assets, query assets, create new assets, update assets and transfer an asset to a new owner. It has two components: application and smart contract. The application makes calls to the blockchain network to invoke transactions implemented in the chaincode (smart contract). The smart contract implements the transactions that involve interactions with the ledger.</p><h4 id="Set-Up-Blockchain-Network"><a href="#Set-Up-Blockchain-Network" class="headerlink" title="Set Up Blockchain Network"></a>Set Up Blockchain Network</h4><p>Launch network by using <code>network.sh</code> script. Bring down current running network and bring up a new one with Certificate Authorities.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd fabric-samples/test-network</span><br><span class="line">./network.sh down</span><br><span class="line">./network.sh up createChannel -c mychannel -ca</span><br></pre></td></tr></table></figure><p>The script will deploy the Fabric test network with two peers, an ordering service and three certificate authorities.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">Creating channel 'mychannel'.</span><br><span class="line">If network is not up, starting nodes with CLI timeout of '5' tries and CLI delay of '3' seconds and using database 'leveldb with crypto from 'Certificate Authorities'</span><br><span class="line">Bringing up network</span><br><span class="line">LOCAL_VERSION=2.3.1</span><br><span class="line">DOCKER_IMAGE_VERSION=2.3.1</span><br><span class="line">CA_LOCAL_VERSION=1.4.9</span><br><span class="line">CA_DOCKER_IMAGE_VERSION=1.4.9</span><br><span class="line">Generating certificates using Fabric CA</span><br><span class="line">Creating network "fabric_test" with the default driver</span><br><span class="line">Creating ca_org2    ... done</span><br><span class="line">Creating ca_orderer ... done</span><br><span class="line">Creating ca_org1    ... done</span><br><span class="line">...</span><br><span class="line">Generating CCP files for Org1 and Org2</span><br><span class="line">Creating volume "docker_orderer.example.com" with default driver</span><br><span class="line">Creating volume "docker_peer0.org1.example.com" with default driver</span><br><span class="line">Creating volume "docker_peer0.org2.example.com" with default driver</span><br><span class="line">WARNING: Found orphan containers (ca_org2, ca_orderer, ca_org1) for this project. If you removed or renamed this service in your compose file, you can run this command with the --remove-orphans flag to clean it up.</span><br><span class="line">Creating orderer.example.com    ... done</span><br><span class="line">Creating peer0.org2.example.com ... done</span><br><span class="line">Creating peer0.org1.example.com ... done</span><br><span class="line">Creating cli                    ... done</span><br><span class="line">CONTAINER ID        IMAGE                               COMMAND                  CREATED                  STATUS                  PORTS                                            NAMES</span><br><span class="line">cb268c151387        hyperledger/fabric-tools:latest     "/bin/bash"              Less than a second ago   Up Less than a second                                                    cli</span><br><span class="line">82354eb9645d        hyperledger/fabric-peer:latest      "peer node start"        2 seconds ago            Up Less than a second   0.0.0.0:7051-&gt;7051/tcp                           peer0.org1.example.com</span><br><span class="line">96303fd44a6b        hyperledger/fabric-peer:latest      "peer node start"        2 seconds ago            Up Less than a second   7051/tcp, 0.0.0.0:9051-&gt;9051/tcp                 peer0.org2.example.com</span><br><span class="line">9c37906e598b        hyperledger/fabric-orderer:latest   "orderer"                2 seconds ago            Up Less than a second   0.0.0.0:7050-&gt;7050/tcp, 0.0.0.0:7053-&gt;7053/tcp   orderer.example.com</span><br><span class="line">4179c79f4d47        hyperledger/fabric-ca:latest        "sh -c 'fabric-ca-se…"   6 seconds ago            Up 5 seconds            0.0.0.0:7054-&gt;7054/tcp                           ca_org1</span><br><span class="line">33810360a9c3        hyperledger/fabric-ca:latest        "sh -c 'fabric-ca-se…"   6 seconds ago            Up 5 seconds            7054/tcp, 0.0.0.0:9054-&gt;9054/tcp                 ca_orderer</span><br><span class="line">fdf33f12e860        hyperledger/fabric-ca:latest        "sh -c 'fabric-ca-se…"   6 seconds ago            Up 5 seconds            7054/tcp, 0.0.0.0:8054-&gt;8054/tcp                 ca_org2</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>Deploy the chaincode with the chaincode name and language options.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./network.sh deployCC -ccn basic -ccp ../asset-transfer-basic/chaincode-javascript/ -ccl javascript</span><br></pre></td></tr></table></figure><p>The chaincode will be successfully deployed.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">deploying chaincode on channel 'mychannel'</span><br><span class="line">executing with the following</span><br><span class="line">- CHANNEL_NAME: mychannel</span><br><span class="line">- CC_NAME: basic</span><br><span class="line">- CC_SRC_PATH: ../asset-transfer-basic/chaincode-javascript/</span><br><span class="line">- CC_SRC_LANGUAGE: javascript</span><br><span class="line">...</span><br><span class="line">Committed chaincode definition for chaincode 'basic' on channel 'mychannel':</span><br><span class="line">Version: 1.0, Sequence: 1, Endorsement Plugin: escc, Validation Plugin: vscc, Approvals: [Org1MSP: true, Org2MSP: true]</span><br><span class="line">Query chaincode definition successful on peer0.org2 on channel 'mychannel'</span><br><span class="line">Chaincode initialization is not required</span><br></pre></td></tr></table></figure><h4 id="Sample-Application"><a href="#Sample-Application" class="headerlink" title="Sample Application"></a>Sample Application</h4><p>Install application dependencies for sample programs developed using Fabric SDK for Node.js.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd asset-transfer-basic/application-javascript</span><br><span class="line">npm install</span><br></pre></td></tr></table></figure><p>Dependencies defined in <code>package.json</code> will be installed and the directory will contain following files.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zhiqich@ubuntu:~/fabric-samples/asset-transfer-basic/application-javascript$ ls</span><br><span class="line">app.js  node_modules  package.json  package-lock.json</span><br></pre></td></tr></table></figure><p>Run application by the following command.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node app.js</span><br></pre></td></tr></table></figure><p>And results look like following.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line">Loaded the network configuration located at /home/zhiqich/fabric-samples/test-network/organizations/peerOrganizations/org1.example.com/connection-org1.json</span><br><span class="line">Built a CA Client named ca-org1</span><br><span class="line">Built a file system wallet at /home/zhiqich/fabric-samples/asset-transfer-basic/application-javascript/wallet</span><br><span class="line">Successfully enrolled admin user and imported it into the wallet</span><br><span class="line">Successfully registered and enrolled user appUser and imported it into the wallet</span><br><span class="line"></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Submit Transaction: InitLedger, <span class="keyword">function</span> creates the initial <span class="built_in">set</span> of assets on the ledger</span></span><br><span class="line">*** Result: committed</span><br><span class="line"></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Evaluate Transaction: GetAllAssets, <span class="keyword">function</span> returns all the current assets on the ledger</span></span><br><span class="line">*** Result: [</span><br><span class="line">  &#123;</span><br><span class="line">    "Key": "asset1",</span><br><span class="line">    "Record": &#123;</span><br><span class="line">      "ID": "asset1",</span><br><span class="line">      "Color": "blue",</span><br><span class="line">      "Size": 5,</span><br><span class="line">      "Owner": "Tomoko",</span><br><span class="line">      "AppraisedValue": 300,</span><br><span class="line">      "docType": "asset"</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    "Key": "asset2",</span><br><span class="line">    "Record": &#123;</span><br><span class="line">      "ID": "asset2",</span><br><span class="line">      "Color": "red",</span><br><span class="line">      "Size": 5,</span><br><span class="line">      "Owner": "Brad",</span><br><span class="line">      "AppraisedValue": 400,</span><br><span class="line">      "docType": "asset"</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    "Key": "asset3",</span><br><span class="line">    "Record": &#123;</span><br><span class="line">      "ID": "asset3",</span><br><span class="line">      "Color": "green",</span><br><span class="line">      "Size": 10,</span><br><span class="line">      "Owner": "Jin Soo",</span><br><span class="line">      "AppraisedValue": 500,</span><br><span class="line">      "docType": "asset"</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    "Key": "asset4",</span><br><span class="line">    "Record": &#123;</span><br><span class="line">      "ID": "asset4",</span><br><span class="line">      "Color": "yellow",</span><br><span class="line">      "Size": 10,</span><br><span class="line">      "Owner": "Max",</span><br><span class="line">      "AppraisedValue": 600,</span><br><span class="line">      "docType": "asset"</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    "Key": "asset5",</span><br><span class="line">    "Record": &#123;</span><br><span class="line">      "ID": "asset5",</span><br><span class="line">      "Color": "black",</span><br><span class="line">      "Size": 15,</span><br><span class="line">      "Owner": "Adriana",</span><br><span class="line">      "AppraisedValue": 700,</span><br><span class="line">      "docType": "asset"</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    "Key": "asset6",</span><br><span class="line">    "Record": &#123;</span><br><span class="line">      "ID": "asset6",</span><br><span class="line">      "Color": "white",</span><br><span class="line">      "Size": 15,</span><br><span class="line">      "Owner": "Michel",</span><br><span class="line">      "AppraisedValue": 800,</span><br><span class="line">      "docType": "asset"</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Submit Transaction: CreateAsset, creates new asset with ID, color, owner, size, and appraisedValue arguments</span></span><br><span class="line">*** Result: committed</span><br><span class="line">*** Result: &#123;</span><br><span class="line">  "ID": "asset13",</span><br><span class="line">  "Color": "yellow",</span><br><span class="line">  "Size": "5",</span><br><span class="line">  "Owner": "Tom",</span><br><span class="line">  "AppraisedValue": "1300"</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Evaluate Transaction: ReadAsset, <span class="keyword">function</span> returns an asset with a given assetID</span></span><br><span class="line">*** Result: &#123;</span><br><span class="line">  "ID": "asset13",</span><br><span class="line">  "Color": "yellow",</span><br><span class="line">  "Size": "5",</span><br><span class="line">  "Owner": "Tom",</span><br><span class="line">  "AppraisedValue": "1300"</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Evaluate Transaction: AssetExists, <span class="keyword">function</span> returns <span class="string">"true"</span> <span class="keyword">if</span> an asset with given assetID exist</span></span><br><span class="line">*** Result: true</span><br><span class="line"></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Submit Transaction: UpdateAsset asset1, change the appraisedValue to 350</span></span><br><span class="line">*** Result: committed</span><br><span class="line"></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Evaluate Transaction: ReadAsset, <span class="keyword">function</span> returns <span class="string">"asset1"</span> attributes</span></span><br><span class="line">*** Result: &#123;</span><br><span class="line">  "ID": "asset1",</span><br><span class="line">  "Color": "blue",</span><br><span class="line">  "Size": "5",</span><br><span class="line">  "Owner": "Tomoko",</span><br><span class="line">  "AppraisedValue": "350"</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Submit Transaction: UpdateAsset asset70, asset70 does not exist and should <span class="built_in">return</span> an error</span></span><br><span class="line">2021-03-05T17:06:59.733Z - error: [Transaction]: Error: No valid responses from any peers. Errors:</span><br><span class="line">    peer=peer0.org2.example.com:9051, status=500, message=error in simulation: transaction returned with failure: Error: The asset asset70 does not exist</span><br><span class="line">    peer=peer0.org1.example.com:7051, status=500, message=error in simulation: transaction returned with failure: Error: The asset asset70 does not exist</span><br><span class="line">*** Successfully caught the error: </span><br><span class="line">    Error: No valid responses from any peers. Errors:</span><br><span class="line">    peer=peer0.org2.example.com:9051, status=500, message=error in simulation: transaction returned with failure: Error: The asset asset70 does not exist</span><br><span class="line">    peer=peer0.org1.example.com:7051, status=500, message=error in simulation: transaction returned with failure: Error: The asset asset70 does not exist</span><br><span class="line"></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Submit Transaction: TransferAsset asset1, transfer to new owner of Tom</span></span><br><span class="line">*** Result: committed</span><br><span class="line"></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Evaluate Transaction: ReadAsset, <span class="keyword">function</span> returns <span class="string">"asset1"</span> attributes</span></span><br><span class="line">*** Result: &#123;</span><br><span class="line">  "ID": "asset1",</span><br><span class="line">  "Color": "blue",</span><br><span class="line">  "Size": "5",</span><br><span class="line">  "Owner": "Tom",</span><br><span class="line">  "AppraisedValue": "350"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Enroll-Admin-User"><a href="#Enroll-Admin-User" class="headerlink" title="Enroll Admin User"></a>Enroll Admin User</h4><p>Admin registration is bootstrapped when the Certificate Authority is started, and it is executed right after the profile and wallet paths are specified.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// build an in memory object with the network configuration (also known as a connection profile)</span></span><br><span class="line"><span class="keyword">const</span> ccp = buildCCPOrg1();</span><br><span class="line"></span><br><span class="line"><span class="comment">// build an instance of the fabric ca services client based on</span></span><br><span class="line"><span class="comment">// the information in the network configuration</span></span><br><span class="line"><span class="keyword">const</span> caClient = buildCAClient(FabricCAServices, ccp, <span class="string">'ca.org1.example.com'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// setup the wallet to hold the credentials of the application user</span></span><br><span class="line"><span class="keyword">const</span> wallet = <span class="keyword">await</span> buildWallet(Wallets, walletPath);</span><br><span class="line"></span><br><span class="line"><span class="comment">// in a real application this would be done on an administrative flow, and only once</span></span><br><span class="line"><span class="keyword">await</span> enrollAdmin(caClient, wallet, mspOrg1);</span><br></pre></td></tr></table></figure><p>After successfully enrolling admin, the log will print the following.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Built a CA Client named ca-org1</span><br><span class="line">Built a file system wallet at /home/zhiqich/fabric-samples/asset-transfer-basic/application-javascript/wallet</span><br><span class="line">Successfully enrolled admin user and imported it into the wallet</span><br></pre></td></tr></table></figure><h4 id="Register-and-Enroll-Application-User"><a href="#Register-and-Enroll-Application-User" class="headerlink" title="Register and Enroll Application User"></a>Register and Enroll Application User</h4><p>Application users are registered and enrolled by the <code>admin</code> user, and they will be used to interact with the blockchain network.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// in a real application this would be done only when a new user was required to be added</span></span><br><span class="line"><span class="comment">// and would be part of an administrative flow</span></span><br><span class="line"><span class="keyword">await</span> registerAndEnrollUser(caClient, wallet, mspOrg1, org1UserId, <span class="string">'org1.department1'</span>);</span><br></pre></td></tr></table></figure><p>After successfully enrolling user, the log will print the following.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Successfully registered and enrolled user appUser and imported it into the wallet</span><br></pre></td></tr></table></figure><h4 id="Prepare-Connection-to-Channel-and-Smart-Contract"><a href="#Prepare-Connection-to-Channel-and-Smart-Contract" class="headerlink" title="Prepare Connection to Channel and Smart Contract"></a>Prepare Connection to Channel and Smart Contract</h4><p>Use contract name and channel name to get reference to the Contract via Gateway. <code>getContract()</code> API is provided.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// setup the gateway instance</span></span><br><span class="line"><span class="comment">// The user will now be able to create connections to the fabric network and be able to</span></span><br><span class="line"><span class="comment">// submit transactions and query. All transactions submitted by this gateway will be</span></span><br><span class="line"><span class="comment">// signed by this user using the credentials stored in the wallet.</span></span><br><span class="line"><span class="keyword">await</span> gateway.connect(ccp, &#123;</span><br><span class="line">    wallet,</span><br><span class="line">    identity: org1UserId,</span><br><span class="line">    discovery: &#123; <span class="attr">enabled</span>: <span class="literal">true</span>, <span class="attr">asLocalhost</span>: <span class="literal">true</span> &#125; <span class="comment">// using asLocalhost as this gateway is using a fabric network deployed locally</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Build a network instance based on the channel where the smart contract is deployed</span></span><br><span class="line"><span class="keyword">const</span> network = <span class="keyword">await</span> gateway.getNetwork(channelName);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get the contract from the network.</span></span><br><span class="line"><span class="keyword">const</span> contract = network.getContract(chaincodeName);</span><br></pre></td></tr></table></figure><h4 id="Initialize-Ledger"><a href="#Initialize-Ledger" class="headerlink" title="Initialize Ledger"></a>Initialize Ledger</h4><p>The <code>submitTransaction()</code> function is used to invoke the chaincode <code>InitLedger()</code> function to populate the ledger with some sample data.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Initialize a set of asset data on the channel using the chaincode 'InitLedger' function.</span></span><br><span class="line"><span class="comment">// This type of transaction would only be run once by an application the first time it was started after it</span></span><br><span class="line"><span class="comment">// deployed the first time. Any updates to the chaincode deployed later would likely not need to run</span></span><br><span class="line"><span class="comment">// an "init" type function.</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'\n--&gt; Submit Transaction: InitLedger, function creates the initial set of assets on the ledger'</span>);</span><br><span class="line"><span class="keyword">await</span> contract.submitTransaction(<span class="string">'InitLedger'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'*** Result: committed'</span>);</span><br><span class="line">...</span><br><span class="line"><span class="keyword">async</span> InitLedger(ctx) &#123;</span><br><span class="line">     <span class="keyword">const</span> assets = [</span><br><span class="line">         &#123;</span><br><span class="line">             ID: <span class="string">'asset1'</span>,</span><br><span class="line">             Color: <span class="string">'blue'</span>,</span><br><span class="line">             Size: <span class="number">5</span>,</span><br><span class="line">             Owner: <span class="string">'Tomoko'</span>,</span><br><span class="line">             AppraisedValue: <span class="number">300</span>,</span><br><span class="line">         &#125;,</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>The log after successful initialization will be the following.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">--&gt;</span><span class="bash"> Submit Transaction: InitLedger, <span class="keyword">function</span> creates the initial <span class="built_in">set</span> of assets on the ledger</span></span><br><span class="line">*** Result: committed</span><br></pre></td></tr></table></figure><h4 id="Invoke-Chaincode-Function"><a href="#Invoke-Chaincode-Function" class="headerlink" title="Invoke Chaincode Function"></a>Invoke Chaincode Function</h4><p>Each peer in a blockchain network hosts a copy of the ledger. An application program can view the most recent data from the ledger using read-only invocations of a smart contract (query). Applications can query data (key-value pairs) for a single or multiple keys. JSON query is also supported. The <code>evaluateTransaction</code> function is used to call <code>GetAllAssets()</code> function which returns all assets found in the world state.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Let's try a query type operation (function).</span></span><br><span class="line"><span class="comment">// This will be sent to just one peer and the results will be shown.</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'\n--&gt; Evaluate Transaction: GetAllAssets, function returns all the current assets on the ledger'</span>);</span><br><span class="line"><span class="keyword">let</span> result = <span class="keyword">await</span> contract.evaluateTransaction(<span class="string">'GetAllAssets'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`*** Result: <span class="subst">$&#123;prettyJSONString(result.toString())&#125;</span>`</span>);</span><br><span class="line">...</span><br><span class="line"><span class="comment">// GetAllAssets returns all assets found in the world state.</span></span><br><span class="line"><span class="keyword">async</span> GetAllAssets(ctx) &#123;</span><br><span class="line">    <span class="keyword">const</span> allResults = [];</span><br><span class="line">    <span class="comment">// range query with empty string for startKey and endKey does an open-ended query of all assets in the chaincode namespace.</span></span><br><span class="line">    <span class="keyword">const</span> iterator = <span class="keyword">await</span> ctx.stub.getStateByRange(<span class="string">''</span>, <span class="string">''</span>);</span><br><span class="line">    <span class="keyword">let</span> result = <span class="keyword">await</span> iterator.next();</span><br><span class="line">    <span class="keyword">while</span> (!result.done) &#123;</span><br><span class="line">        <span class="keyword">const</span> strValue = Buffer.from(result.value.value.toString()).toString(<span class="string">'utf8'</span>);</span><br><span class="line">        <span class="keyword">let</span> record;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            record = <span class="built_in">JSON</span>.parse(strValue);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(err);</span><br><span class="line">            record = strValue;</span><br><span class="line">        &#125;</span><br><span class="line">        allResults.push(&#123; <span class="attr">Key</span>: result.value.key, <span class="attr">Record</span>: record &#125;);</span><br><span class="line">        result = <span class="keyword">await</span> iterator.next();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">JSON</span>.stringify(allResults);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The results should be the following.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">--&gt;</span><span class="bash"> Evaluate Transaction: GetAllAssets, <span class="keyword">function</span> returns all the current assets on the ledger</span></span><br><span class="line">*** Result: [</span><br><span class="line">  &#123;</span><br><span class="line">    "Key": "asset1",</span><br><span class="line">    "Record": &#123;</span><br><span class="line">      "ID": "asset1",</span><br><span class="line">      "Color": "blue",</span><br><span class="line">      "Size": 5,</span><br><span class="line">      "Owner": "Tomoko",</span><br><span class="line">      "AppraisedValue": 300,</span><br><span class="line">      "docType": "asset"</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>The function <code>submitTransaction()</code> can also be used to call function <code>CreateAsset()</code> to add a new asset to the world state.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CreateAsset issues a new asset to the world state with given details.</span></span><br><span class="line"><span class="keyword">async</span> CreateAsset(ctx, id, color, size, owner, appraisedValue) &#123;</span><br><span class="line">  <span class="keyword">const</span> asset = &#123;</span><br><span class="line">      ID: id,</span><br><span class="line">      Color: color,</span><br><span class="line">      Size: size,</span><br><span class="line">      Owner: owner,</span><br><span class="line">      AppraisedValue: appraisedValue,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> ctx.stub.putState(id, Buffer.from(<span class="built_in">JSON</span>.stringify(asset)));</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">--&gt; Submit Transaction: CreateAsset, creates <span class="keyword">new</span> asset <span class="keyword">with</span> ID, color, owner, size, and appraisedValue <span class="built_in">arguments</span></span><br><span class="line">*** Result: committed</span><br><span class="line">*** Result: &#123;</span><br><span class="line">  <span class="string">"ID"</span>: <span class="string">"asset13"</span>,</span><br><span class="line">  <span class="string">"Color"</span>: <span class="string">"yellow"</span>,</span><br><span class="line">  <span class="string">"Size"</span>: <span class="string">"5"</span>,</span><br><span class="line">  <span class="string">"Owner"</span>: <span class="string">"Tom"</span>,</span><br><span class="line">  <span class="string">"AppraisedValue"</span>: <span class="string">"1300"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The chaincode also provides <code>AssetExists()</code>, <code>ReadAsset()</code> functions called by <code>evaluateTransaction()</code> function and <code>UpdateAsset()</code>, <code>TransferAsset()</code> functions called by <code>submitTransaction()</code> function to check whether a specific asset exists, get specific asset data, update a specific asset, and transfer a specific asset to a new owner.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AssetExists returns true when asset with given ID exists in world state.</span></span><br><span class="line"><span class="keyword">async</span> AssetExists(ctx, id) &#123;</span><br><span class="line">    <span class="keyword">const</span> assetJSON = <span class="keyword">await</span> ctx.stub.getState(id);</span><br><span class="line">    <span class="keyword">return</span> assetJSON &amp;&amp; assetJSON.length &gt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ReadAsset returns the asset stored in the world state with given id.</span></span><br><span class="line"><span class="keyword">async</span> ReadAsset(ctx, id) &#123;</span><br><span class="line">    <span class="keyword">const</span> assetJSON = <span class="keyword">await</span> ctx.stub.getState(id); <span class="comment">// get the asset from chaincode state</span></span><br><span class="line">    <span class="keyword">if</span> (!assetJSON || assetJSON.length === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`The asset <span class="subst">$&#123;id&#125;</span> does not exist`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> assetJSON.toString();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// UpdateAsset updates an existing asset in the world state with provided parameters.</span></span><br><span class="line"><span class="keyword">async</span> UpdateAsset(ctx, id, color, size, owner, appraisedValue) &#123;</span><br><span class="line">    <span class="keyword">const</span> exists = <span class="keyword">await</span> <span class="keyword">this</span>.AssetExists(ctx, id);</span><br><span class="line">    <span class="keyword">if</span> (!exists) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`The asset <span class="subst">$&#123;id&#125;</span> does not exist`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// overwriting original asset with new asset</span></span><br><span class="line">    <span class="keyword">const</span> updatedAsset = &#123;</span><br><span class="line">        ID: id,</span><br><span class="line">        Color: color,</span><br><span class="line">        Size: size,</span><br><span class="line">        Owner: owner,</span><br><span class="line">        AppraisedValue: appraisedValue,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> ctx.stub.putState(id, Buffer.from(<span class="built_in">JSON</span>.stringify(updatedAsset)));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// TransferAsset updates the owner field of asset with given id in the world state.</span></span><br><span class="line"><span class="keyword">async</span> TransferAsset(ctx, id, newOwner) &#123;</span><br><span class="line">    <span class="keyword">const</span> assetString = <span class="keyword">await</span> <span class="keyword">this</span>.ReadAsset(ctx, id);</span><br><span class="line">    <span class="keyword">const</span> asset = <span class="built_in">JSON</span>.parse(assetString);</span><br><span class="line">    asset.Owner = newOwner;</span><br><span class="line">    <span class="keyword">return</span> ctx.stub.putState(id, Buffer.from(<span class="built_in">JSON</span>.stringify(asset)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;</summary>
        
      
    
    
    
    <category term="project" scheme="http://yoursite.com/categories/project/"/>
    
    
  </entry>
  
  <entry>
    <title>iOS14 USB Tethering Issue on Ubuntu20.04 LTS</title>
    <link href="http://yoursite.com/2021/03/04/tethering/"/>
    <id>http://yoursite.com/2021/03/04/tethering/</id>
    <published>2021-03-05T02:40:00.000Z</published>
    <updated>2021-03-05T03:08:14.868Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="Issue"><a href="#Issue" class="headerlink" title="Issue"></a>Issue</h2><p>Due to the change of <code>IPHETH_BUF_SIZE</code> parameter from 1516 to 1514 in iOS14, iPhone could not provide tethering connection to Ubuntu20.04 LTS.</p><h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>Modify the <code>IPHETH_BUF_SIZE</code> parameter in the source file <em>ipheth.c</em>.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo -i</span><br><span class="line">cd /lib/modules/$(uname -r)/kernel/drivers/net/usb/</span><br><span class="line">cp -ia ipheth.ko ipheth.ko.orig</span><br><span class="line">xxd -p -c 20000 ipheth.ko.orig | sed 's/ec05/ea05/g' | xxd -r -p &gt; ipheth.ko</span><br><span class="line">strip --strip-debug ipheth.ko</span><br><span class="line">rmmod ipheth; modprobe ipheth</span><br></pre></td></tr></table></figure><h2 id="Prerequisite"><a href="#Prerequisite" class="headerlink" title="Prerequisite"></a>Prerequisite</h2><p>Install <code>sudo apt install build-essential</code> if there’s Wi-Fi or ethernet connection. If there’s no internet access available on the device, try downloading Ubuntu deb packages of build-essential <a href="https://drive.google.com/drive/folders/1olJSft3HWL2qdB1lxQxhTkJblFSFSrU1?usp=sharing" target="_blank" rel="noopener">Download</a> and installing with command <code>sudo dpkg -i package_name.deb</code>.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg -i libc6_2.31-0ubuntu9.1_amd64.deb</span><br><span class="line">sudo dpkg -i manpages-dev_5.05-1_all.deb</span><br><span class="line">sudo dpkg -i binutils-common_2.34-6ubuntu1_amd64.deb</span><br><span class="line">sudo dpkg -i linux-libc-dev_5.4.0-48.52_amd64.deb</span><br><span class="line">sudo dpkg -i libctf-nobfd0_2.34-6ubuntu1_amd64.deb</span><br><span class="line">sudo dpkg -i libgomp1_10.2.0-5ubuntu1~20.04_amd64.deb</span><br><span class="line">sudo dpkg -i libquadmath0_10.2.0-5ubuntu1~20.04_amd64.deb</span><br><span class="line">sudo dpkg -i libmpc3_1.1.0-1_amd64.deb</span><br><span class="line">sudo dpkg -i libatomic1_10.2.0-5ubuntu1~20.04_amd64.deb</span><br><span class="line">sudo dpkg -i libubsan1_10.2.0-5ubuntu1~20.04_amd64.deb</span><br><span class="line">sudo dpkg -i libcrypt-dev_4.4.10-10ubuntu4_amd64.deb</span><br><span class="line">sudo dpkg -i libisl22_0.22.1-1_amd64.deb</span><br><span class="line">sudo dpkg -i libbinutils_2.34-6ubuntu1_amd64.deb</span><br><span class="line">sudo dpkg -i libc-dev-bin_2.31-0ubuntu9.1_amd64.deb</span><br><span class="line">sudo dpkg -i libcc1-0_10.2.0-5ubuntu1~20.04_amd64.deb</span><br><span class="line">sudo dpkg -i liblsan0_10.2.0-5ubuntu1~20.04_amd64.deb</span><br><span class="line">sudo dpkg -i libitm1_10.2.0-5ubuntu1~20.04_amd64.deb</span><br><span class="line">sudo dpkg -i gcc-9-base_9.3.0-10ubuntu2_amd64.deb</span><br><span class="line">sudo dpkg -i libtsan0_10.2.0-5ubuntu1~20.04_amd64.deb</span><br><span class="line">sudo dpkg -i libctf0_2.34-6ubuntu1_amd64.deb</span><br><span class="line">sudo dpkg -i libasan5_9.3.0-10ubuntu2_amd64.deb</span><br><span class="line">sudo dpkg -i cpp-9_9.3.0-10ubuntu2_amd64.deb</span><br><span class="line">sudo dpkg -i libc6-dev_2.31-0ubuntu9.1_amd64.deb</span><br><span class="line">sudo dpkg -i binutils-x86-64-linux-gnu_2.34-6ubuntu1_amd64.deb</span><br><span class="line">sudo dpkg -i binutils_2.34-6ubuntu1_amd64.deb</span><br><span class="line">sudo dpkg -i libgcc-9-dev_9.3.0-10ubuntu2_amd64.deb</span><br><span class="line">sudo dpkg -i cpp_9.3.0-1ubuntu2_amd64.deb</span><br><span class="line">sudo dpkg -i gcc-9_9.3.0-10ubuntu2_amd64.deb</span><br><span class="line">sudo dpkg -i gcc_9.3.0-1ubuntu2_amd64.deb</span><br></pre></td></tr></table></figure><p><i><font color = gray><br>Copyright: Zhihu 「宋泠雨」, CC 4.0 BY-SA<br><a href="https://zhuanlan.zhihu.com/p/342499361\" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/342499361\</a><br>Copyright: CSDN 「恍恍惚惚斯基」, CC 4.0 BY-SA<br><a href="https://blog.csdn.net/weixin_42432439/article/details/108777302" target="_blank" rel="noopener">https://blog.csdn.net/weixin_42432439/article/details/108777302</a><br></font></i></p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;</summary>
        
      
    
    
    
    <category term="project" scheme="http://yoursite.com/categories/project/"/>
    
    
  </entry>
  
  <entry>
    <title>9</title>
    <link href="http://yoursite.com/2021/03/02/9/"/>
    <id>http://yoursite.com/2021/03/02/9/</id>
    <published>2021-03-02T18:47:34.000Z</published>
    <updated>2021-03-02T18:51:27.233Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><center><i><font color = gray>《繁花》 金宇澄</font></i></center><p>阿宝十岁，<br>邻居蓓蒂六岁。<br>两个人从假三层爬上屋顶，<br>瓦片温热，眼里是半个卢湾区……<br>蓓蒂拉紧阿宝，<br>小身体靠紧，<br>头发飞舞。<br>东南风一劲，<br>听见黄浦江船鸣，<br>圆号宽广的嗡嗡声，<br>抚慰少年人胸怀。</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;</summary>
        
      
    
    
    
    <category term="raving" scheme="http://yoursite.com/categories/raving/"/>
    
    
  </entry>
  
  <entry>
    <title>OpenDHT</title>
    <link href="http://yoursite.com/2021/02/10/opendht/"/>
    <id>http://yoursite.com/2021/02/10/opendht/</id>
    <published>2021-02-11T04:46:29.000Z</published>
    <updated>2021-02-11T04:51:38.295Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>OpenDHT is a lightweight C++14 Distributed Hash Table implementation. It provides an easy to use distributed in-memory data store. Every node in the network can read and write values to the store. Values are distributed over the network, with redundancy.</p><h2 id="Build"><a href="#Build" class="headerlink" title="Build"></a>Build</h2><h3 id="Tool"><a href="#Tool" class="headerlink" title="Tool"></a>Tool</h3><ul><li>Operating system  <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Linux ubuntu 5.8.0-43-generic #49~20.04.1-Ubuntu SMP Fri Feb 5 09:57:56 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux</span><br></pre></td></tr></table></figure></li><li>GCC  <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gcc (Ubuntu 10.2.0-5ubuntu1~20.04) 10.2.0</span><br><span class="line">Copyright (C) 2020 Free Software Foundation, Inc.</span><br><span class="line">This is free software; see the source for copying conditions.  There is NO</span><br><span class="line">warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span><br></pre></td></tr></table></figure></li><li>Clang  <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">clang version 11.0.0</span><br><span class="line">Target: x86_64-unknown-linux-gnu</span><br><span class="line">Thread model: posix</span><br><span class="line">InstalledDir: /usr/local/bin</span><br></pre></td></tr></table></figure></li><li>CMake  <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cmake version 3.19.4</span><br><span class="line"></span><br><span class="line">CMake suite maintained and supported by Kitware (kitware.com/cmake).</span><br></pre></td></tr></table></figure><h3 id="Dependency"><a href="#Dependency" class="headerlink" title="Dependency"></a>Dependency</h3></li><li>OpenDHT dependencies  <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install libncurses5-dev libreadline-dev nettle-dev libgnutls28-dev libargon2-0-dev libmsgpack-dev  libssl-dev libfmt-dev libjsoncpp-dev libhttp-parser-dev libasio-dev</span><br></pre></td></tr></table></figure></li><li>Python binding dependencies  <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install cython3 python3-dev python3-setuptools</span><br></pre></td></tr></table></figure></li><li>Restinio  <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mkdir restinio &amp;&amp; cd restinio</span><br><span class="line">wget https://github.com/aberaud/restinio/archive/2c0b6f5e5ba04d7a74e8406a3df1fd433680599d.tar.g</span><br><span class="line">ls -l &amp;&amp; tar -xzf 2c0b6f5e5ba04d7a74e8406a3df1fd433680599d.tar.gz</span><br><span class="line">cd restinio-2c0b6f5e5ba04d7a74e8406a3df1fd433680599d/dev</span><br><span class="line">cmake -DCMAKE_INSTALL_PREFIX=/usr -DRESTINIO_TEST=OFF -DRESTINIO_SAMPLE=OFF -DRESTINIO_INSTALL_SAMPLES=OFF -DRESTINIO_BENCH=OFF -DRESTINIO_INSTALL_BENCHES=OFF -DRESTINIO_FIND_DEPS=ON -DRESTINIO_ALLOW_SOBJECTIZER=Off -DRESTINIO_USE_BOOST_ASIO=none .</span><br><span class="line">make -j2</span><br><span class="line">sudo make install</span><br><span class="line">cd ../../../ &amp;&amp; rm -rf restinio</span><br></pre></td></tr></table></figure><h3 id="Build-1"><a href="#Build-1" class="headerlink" title="Build"></a>Build</h3></li><li>Clone the repo  <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/savoirfairelinux/opendht.git</span><br></pre></td></tr></table></figure></li><li>Build and install  <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd opendht</span><br><span class="line">mkdir build &amp;&amp; cd build</span><br><span class="line">cmake -DOPENDHT_PYTHON=ON -DCMAKE_INSTALL_PREFIX=/usr ..</span><br><span class="line">make -j2</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure><h2 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h2><h3 id="Python3"><a href="#Python3" class="headerlink" title="Python3"></a>Python3</h3></li><li>Example code  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> opendht <span class="keyword">as</span> dht</span><br><span class="line"></span><br><span class="line">node = dht.DhtRunner()</span><br><span class="line">node.run()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Join the network through any running node,</span></span><br><span class="line"><span class="comment"># here using a known bootstrap node.</span></span><br><span class="line">node.bootstrap(<span class="string">"bootstrap.jami.net"</span>, <span class="string">"4222"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># blocking call (provide callback arguments to make the call non-blocking)</span></span><br><span class="line">node.put(dht.InfoHash.get(<span class="string">"unique_key"</span>), dht.Value(<span class="string">b'some binary data'</span>))</span><br><span class="line"></span><br><span class="line">results = node.get(dht.InfoHash.get(<span class="string">"unique_key"</span>))</span><br><span class="line"><span class="keyword">for</span> r <span class="keyword">in</span> results:</span><br><span class="line">    print(r)</span><br></pre></td></tr></table></figure></li><li>Command line result  <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Value[id:640b4d1af8908cc4 data:736f6d652062696e6172792064617461]</span><br></pre></td></tr></table></figure></li><li>Decode  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>bytearray.fromhex(<span class="string">"736f6d652062696e6172792064617461"</span>).decode()</span><br><span class="line"><span class="string">'some binary data'</span></span><br></pre></td></tr></table></figure><h2 id="Dhtnode"><a href="#Dhtnode" class="headerlink" title="Dhtnode"></a>Dhtnode</h2>Dhtnode is a command line tool which allows to run a DHT node and perform operations to the distributed in-memory data store.<h3 id="Command-Line-Running"><a href="#Command-Line-Running" class="headerlink" title="Command Line Running"></a>Command Line Running</h3>Dhtnode can run directly in command line. There are several parameters that can be set when creating a dht node.<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dhtnode [-p local_port] [-b bootstrap_host:port] [-n netid] [-i] [-D] [-f] [-v [-l logfile|-L]] [-s|-d]</span><br></pre></td></tr></table></figure></li><li><code>-b</code> allows to specify a bootstrap node address (can be any running node of the DHT network)</li><li><code>-p</code> allows to specify the local UDP port to bind (optional). If not set, will use any available port. Note that the default OpenDHT port (to ideally use for public nodes) is 4222</li><li><code>-D</code> enables the multicast automatic local peer discovery mechanism<h3 id="Command-Line-Interface"><a href="#Command-Line-Interface" class="headerlink" title="Command Line Interface"></a>Command Line Interface</h3><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">OpenDHT command line interface (CLI)</span><br><span class="line">Possible commands:</span><br><span class="line">h, help    Print this help message.</span><br><span class="line">x, quit    Quit the program.</span><br><span class="line">log        Start/stop printing DHT logs.</span><br><span class="line"></span><br><span class="line">Node information:</span><br><span class="line">ll         Print basic information and stats about the current node.</span><br><span class="line">ls [key]   Print basic information about current search(es).</span><br><span class="line">ld [key]   Print basic information about currently stored values on this node (or key).</span><br><span class="line">lr         Print the full current routing table of this node.</span><br><span class="line"></span><br><span class="line">Operations on the DHT:</span><br><span class="line">b &lt;ip:port&gt;           Ping potential node at given IP address/port.</span><br><span class="line">g &lt;key&gt;               Get values at &lt;key&gt;.</span><br><span class="line">l &lt;key&gt;               Listen for value changes at &lt;key&gt;.</span><br><span class="line">cl &lt;key&gt; &lt;token&gt;      Cancel listen for &lt;token&gt; and &lt;key&gt;.</span><br><span class="line">p &lt;key&gt; &lt;str&gt;         Put string value at &lt;key&gt;.</span><br><span class="line">pp &lt;key&gt; &lt;str&gt;        Put string value at &lt;key&gt; (persistent version).</span><br><span class="line">cpp &lt;key&gt; &lt;id&gt;        Cancel persistent put operation for &lt;key&gt; and value &lt;id&gt;.</span><br><span class="line">s &lt;key&gt; &lt;str&gt;         Put string value at &lt;key&gt;, signed with our generated private key.</span><br><span class="line">e &lt;key&gt; &lt;dest&gt; &lt;str&gt;  Put string value at &lt;key&gt;, encrypted for &lt;dest&gt; with its public key (if found).</span><br><span class="line">cc                    Trigger connectivity changed signal.</span><br><span class="line"></span><br><span class="line">Indexation operations on the DHT:</span><br><span class="line">il &lt;name&gt; &lt;key&gt; [exact match]   Lookup the index named &lt;name&gt; with the key &lt;key&gt;.</span><br><span class="line">                                Set [exact match] to 'false' for inexact match lookup.</span><br><span class="line">ii &lt;name&gt; &lt;key&gt; &lt;value&gt;         Inserts the value &lt;value&gt; under the key &lt;key&gt; in the index named &lt;name&gt;.</span><br></pre></td></tr></table></figure><h3 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h3></li><li>Create node  <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">zhiqich@ubuntu:~/Documents/opendht$ dhtnode -D</span><br><span class="line">OpenDHT node db159e7c839b5872692b244deeb849eb8195233b running on port 39901</span><br><span class="line"> (type 'h' or 'help' for a list of possible commands)</span><br></pre></td></tr></table></figure></li><li>Check stats  <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">&gt; ll</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt; OpenDHT node db159e7c839b5872692b244deeb849eb8195233b running on port 39901</span></span><br><span class="line">1 ongoing operations</span><br><span class="line">IPv4 stats:</span><br><span class="line">Known nodes: 0 good, 0 dubious, 0 incoming.</span><br><span class="line">0 searches, 0 total cached nodes</span><br><span class="line"></span><br><span class="line">IPv6 stats:</span><br><span class="line">Known nodes: 0 good, 0 dubious, 0 incoming.</span><br><span class="line">0 searches, 0 total cached nodes</span><br></pre></td></tr></table></figure></li><li>Put value  <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">&gt; p <span class="built_in">test</span> <span class="string">"this is a test string"</span></span></span><br><span class="line">Using h(test) = a94a8fe5ccb19ba61c4c0873d391e987982fbbd3</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt; Put: success, took 1.36 ms. Value ID: 8530bb7894ee21b1</span></span><br></pre></td></tr></table></figure></li><li>Get value  <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">&gt; g <span class="built_in">test</span></span></span><br><span class="line">Using h(test) = a94a8fe5ccb19ba61c4c0873d391e987982fbbd3</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt; Get: found 1 value(s) after 178 us</span></span><br><span class="line"> Value[id:8530bb7894ee21b1 data(text/plain):""this"]</span><br><span class="line">Get: completed, took 1.4 ms</span><br></pre></td></tr></table></figure><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/images/opendht-01.jpg" alt=""><h2 id="Dhtchat"><a href="#Dhtchat" class="headerlink" title="Dhtchat"></a>Dhtchat</h2>Dhtchat is a simple IM client working over the dht.<h3 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h3><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">zhiqich@ubuntu:~/Documents/opendht$ dhtchat -h</span><br><span class="line">Usage: dhtchat [-n network_id] [-p local_port] [-b bootstrap_host[:port]]</span><br><span class="line"></span><br><span class="line">dhtchat, a simple OpenDHT command line chat client.</span><br><span class="line">Report bugs to: https://opendht.net</span><br></pre></td></tr></table></figure></li><li>Flags are similar to those of Dhtnode</li><li><code>-D</code> enables the multicast automatic local peer discovery mechanism<h3 id="Command-Line-Interface-1"><a href="#Command-Line-Interface-1" class="headerlink" title="Command Line Interface"></a>Command Line Interface</h3></li><li><code>c {channel}</code> to join a channel</li><li><code>d</code> to disconnect the channel</li><li><code>e {target} {message}</code> to send an encrypted message to a specific user with public key ID<h3 id="Demo-1"><a href="#Demo-1" class="headerlink" title="Demo"></a>Demo</h3></li><li>Create chat node  <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">zhiqich@ubuntu:~/Documents/opendht$ dhtchat -D</span><br><span class="line">OpenDHT node 1f04c73f6c5af467cd68ba4058a065bc0731ac19 running on port 59537</span><br><span class="line">Public key ID ecd52bfcb037b225e9021d5149a84a17eb881f4b</span><br><span class="line">  type 'c &#123;hash&#125;' to join a channel</span><br></pre></td></tr></table></figure></li><li>Join channel  <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> c <span class="built_in">test</span></span></span><br><span class="line">Joining h(test) = a94a8fe5ccb19ba61c4c0873d391e987982fbbd3</span><br></pre></td></tr></table></figure></li><li>Chat  <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">&gt; hi</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt; d108ebdc3f238876e94e59d6214ab465d644b460 at 2021-02-10 23:09:59 (took 0.811252s) : 10835693456077075259 - hi</span></span><br></pre></td></tr></table></figure><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/images/opendht-02.jpg" alt=""><br><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/images/opendht-03.jpg" alt=""></li></ul>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;</summary>
        
      
    
    
    
    <category term="project" scheme="http://yoursite.com/categories/project/"/>
    
    
  </entry>
  
  <entry>
    <title>Japan</title>
    <link href="http://yoursite.com/2021/02/10/japan/"/>
    <id>http://yoursite.com/2021/02/10/japan/</id>
    <published>2021-02-11T04:32:11.000Z</published>
    <updated>2021-03-08T05:28:53.333Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>跑代码的时候迷迷糊糊睡着了，梦到在跟三岛喝茶聊天，茶水太烫就醒了，到底聊了什么也记不真切了，倒是提醒我在记忆没模糊之前赶紧记下些东西。</p><p>我是在2018年初去的日本，掐头去尾总共待了六天，走了大阪、京都和东京这三个城市，赶在东京大雪前一天回的家。当时对日本文学特别痴迷，无法拒绝留白带来的情感上的刺激，于是很坚定地决定一个人旅行。</p><p>在关西国际机场下了飞机，搭乘关西机场线前往市区。原本打算乘南海电气铁道特快的，就是那个蓝色的铁胆火车侠，结果发现忘买特快票了，只好搭乘慢车，就当慢慢欣赏沿途风景了。从乡间驶向城郊，最后进到市区，原本车上大多都是来旅游的小家庭，慢慢多了些提着公文包下班回家的人，再后来是穿着制服的学生，从上车到下车一直喋喋不休，感觉和旁边安静看书的上班族像是两个世界的人。我总觉得有些格格不入，内心是活泼的，行为又受诸多克制，像夹在两者中间，后来索性从座位站了起来专心看窗外。日本这些JR线路车票都挺有意思的，仔细看上面印着些动漫人物的图案，纸张手感也不错，我特意随身带了一个收藏夹，把车票、门票还有小票这些乱七八糟的小玩意儿都收了起来，现在应该还躺在家里的书橱里。</p><p>到酒店放好行李，听懂了“black fast”是什么意思之后，就直接跑去梅田蓝天大厦，想看看日落，结果忘了有一个小时的时差，出了地铁站已经天黑了，直接成了看夜景。展望台真的是像星空一般洒了点点荧光，城市的灯光看得入神。下了楼差不多也有七八点了，刚好跑去道顿堀吃晚饭。记得很清楚第一顿吃的是金龙拉面。日本点菜是有一个小机器，每道菜有个按钮，想吃什么就按什么，然后直接在机器上付钱拿小票，再把小票给店家就好了。我偷偷看前面几位的操作，就学会了，避免了尴尬。金龙拉面的店面是半露天的，有点像武侠小说客栈的那种感觉，体验很棒。之后在道顿堀心斋桥边走边看，尝了街边的章鱼丸子，还有另几样叫不出名字的小吃，吃饱喝足后回家。</p><p>第二天一大早去了大阪城公园和里头的天守阁。公园其实没什么可看的，跟普通城市公园没什么两样，大多都是老人在晨练健身。天守阁前养了不少鸽子，有一些家长带着孩子在那儿玩儿。可能因为比较早，那个时间段就只有我一个人乘电梯上天守阁，电梯管理员看我好像不是本地人就突然用中文问好，挺惊喜的，跟我说她正在学一点中文，听着没什么口音。天守阁上也就是讲一些日本战国历史，并没有什么特别新奇的，随便转了一会儿就下来了，找到了一个卖冷饮的车，买了一个抹茶甜筒吃。</p><p>这次旅行并没有做太详细的攻略和准备，只是粗略地在纸上写了一些地点，然后看时间和心情走到哪儿是哪儿。下午乘车到了四天王寺附近，吃了顿连锁猪排饭，不知道是不是因为走了一早上太饿了，出奇的好吃。四天王寺那段时间好像刚好在修缮，有一部分建筑被帷幕遮着，也有一些脚手架。寺院人不是很多，大部分是老太太，会花一点钱点一根蜡烛，经过的时候会点头示意，觉得是有一些仪式感在那里的。从四天王寺出来，好像经过了一所幼稚园，误打误撞到了一个叫极乐净土之庭的地方，我看时间还早就进去走了走，没成想竟到了个小世外桃源。园中景观布置很精致，有一些中式园林的感觉，有些岔出的小径尽头会摆上神龛，好像有说法会摆上心脏做祭品，西部世界也有过相似的场景。那天只有我一个游客，真的有种极乐净土的感觉。晚上跑去法善寺横町吃了晚饭，是一家吃串串的店，门口有个大玩偶的，名字记不住了，旁边还有一家买红豆粥（？）的。整个法善寺横町的灯光和氛围特别有日式传统的感觉，刚好下过一点小雨，吃完饭在附近散了散步，有烟火气。</p><p>在大阪的最后一天踩了踩马路，逛了逛通天阁新世界，傍晚去了港口，第一次乘了摩天轮。回家的路上余晖洒在新刷完字的柏油路上，拓下了房屋和电线杆的影子，一瞬间有所感。好像还有一些去过的地方，像是难波、御堂筋、黑门市场，已经记不太清了。</p><p>第二站京都，一座很美好的城市，我一直有些后悔没有留足够的时间游览。从大阪到京都乘的JR电车，很快就到了，在车站寄存了行李之后就直接乘公交去了清水寺。在日本的这几天好像天气都很遂我愿，恰好下着小雨，和清水寺很般配。虽说不是红叶季，古朴的建筑依然很有美感。穿过回廊，走过大殿，一直想着“音羽山清水寺”的名字，觉得实在是太美了，雨打芭蕉，好像听到了石琴的乐音，“松風與音羽瀑布之清水，教鬱結的心涼爽暢意”。据说清水寺是祈愿爱情的地方，于是我也求了一福袋赠予她。从清水寺出来雨也渐渐停了，天空染了晚霞的色彩，沿着三年坂、二年坂的街道下山，两旁有卖抹茶和手工艺品的作坊店铺，也有门口用帘子遮着的居酒屋。我很喜欢听路人谈笑聊天的声音，即便不明白他们在说些什么，但那么开心一定是很有趣的事情。回住处之前先去车站取寄存的行李。一开始我并不知道原来日本同站进出哪怕不乘电车也是要买票的，稀里糊涂地进了站，拿了行李却发现出不了闸机，于是一脸茫然的问服务站的姐姐，讲解一番之后替我开了门，也没有让我补票。我有些记不得京都的第一晚去了哪里，好像只是在住处周边散了散步，那一片都是两三层楼的小房子，很安静，反而有了些生活气息。</p><p>第二天起了个大早，赶着乘车去伏见稻荷大社。因为要换乘两三条线路，在车站拿了张地图，用笔圈画出了换乘站，一路参考路牌和指示，竟有一种小学生第一次出远门的兴奋感。大概七点刚出头就到了神社，虽然离标注的参拜时间还有半个小时，但其实已经允许游客上山了，于是乎一个人独享了千本鸟居，如照片中的一般漂亮，尤其是有阳光斑驳穿过缝隙的时候，是能让人心静的地方。千本鸟居朝上就很少有游客会去了，石阶两旁立着石碑和神龛，供奉着很多神祇。有两处平台可以请护符，我看到一个木质的白狐守，很喜欢它的造像，就带了一个放在背包里，后来在安娜堡的时候有一次差点儿被车撞，回到家发现它从中间整整齐齐断成两截，有那么一丝恍惚。爬到山顶还是需要一些体力的，从那里的观景台可以俯瞰京都，还有卖抹茶冰淇淋的地方，我抵制不了这样的诱惑。下山的路上游客变得越来越多，千本鸟居更是挤满了人，全然失却了美感。我记得那天刚好还是一个祭祀日，说是在下午会焚烧木签祈福，我小小纠结了一番，还是决定去下一个目的地，在我的小本子上还记着太多想去看的地方。</p><p>出了神社就直奔车站乘电车去金阁寺，顺带在路边花了五百日元买了一串烤肉当午饭，分量很足吃的很香。最开始接触日本文学是在高中，受同桌的影响开始看一些日本作家的书，记得有天他买了川端康成的《古都》、《千只鹤》和《睡美人》放在寝室，打算作为生日礼物送给某个女生，书的封面很漂亮。《金阁寺》也是最早听说的日本文学之一，虽然到现在都没能认真读完，印象里书中的金阁寺在一座小山上，能看见海，应该是我记错了。在金阁寺看到一个拿着哈苏相机的老人，很认真地在拍庭院的景观，在一群等着阳光和金灿灿的金阁寺合影的游客里显得很特别。</p><p>后来在安娜堡的落雪天，我看完了夏目友人账，每每看到神社和猫咪老师就会想起那天在八坂神社躺在手水舍旁睡觉的小猫和穿着红色和服祈愿的女生。</p><p>前段时间听《plastic love》有点上头，想起去年暑假困在安娜堡的时候刘玮伦和他们的乐队翻弹翻唱这首歌，还有半夜开车去中校拍“大城市夜景”的事，会心一笑。</p><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=530 height=86 src="//music.163.com/outchain/player?type=2&id=1499202794&auto=0&height=66"></iframe>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;</summary>
        
      
    
    
    
    <category term="travel" scheme="http://yoursite.com/categories/travel/"/>
    
    
  </entry>
  
  <entry>
    <title>8</title>
    <link href="http://yoursite.com/2021/02/08/8/"/>
    <id>http://yoursite.com/2021/02/08/8/</id>
    <published>2021-02-08T05:07:44.000Z</published>
    <updated>2021-02-08T05:28:51.699Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>今早电台随机到了Sufjan Stevens的专辑Greetings From Michigan The Great Lake State，看封面图片有些眼熟，下午码代码的时候突然想起来是在西雅图住的工作室里见到过它的黑胶唱片。算是一个小惊喜，又有点萌生买黑胶唱片机的念头。</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;</summary>
        
      
    
    
    
    <category term="raving" scheme="http://yoursite.com/categories/raving/"/>
    
    
  </entry>
  
  <entry>
    <title>Apache Nutch &amp; Solr</title>
    <link href="http://yoursite.com/2021/01/31/apachenutch/"/>
    <id>http://yoursite.com/2021/01/31/apachenutch/</id>
    <published>2021-01-31T23:36:14.000Z</published>
    <updated>2021-01-31T23:53:11.460Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>Apache Nutch and Apache Solr are projects from Apache Lucene search engine. Nutch is an open source crawler which provides the Java library for crawling, indexing and database storage. Solr is an open source search platform which provides full-text search and integration with Nutch. The following contents are steps of setting up Nutch and Solr for crawling and searching.</p><h2 id="Environment-Setup"><a href="#Environment-Setup" class="headerlink" title="Environment Setup"></a>Environment Setup</h2><h3 id="Operating-System"><a href="#Operating-System" class="headerlink" title="Operating System"></a>Operating System</h3><p>Ubuntu 20.04.1 64bit running on VMware with 4 cores and 8GB memory<br><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/images/nutch-01.jpg" alt=""></p><h3 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h3><p>Java Runtime/Development Environment is JDK 1.8/Java 8<br>Installed by command line </p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install openjdk-8-jdk</span><br></pre></td></tr></table></figure><p>Installation can be checked by </p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -version</span><br></pre></td></tr></table></figure><p>and the result in command line should be </p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openjdk version "1.8.0_275"</span><br><span class="line">OpenJDK Runtime Environment (build 1.8.0_275-8u275-b01-0ubuntu1~20.04-b01)</span><br><span class="line">OpenJDK 64-Bit Server VM (build 25.275-b01, mixed mode)</span><br></pre></td></tr></table></figure><p>After installation, add the JAVA_HOME parameter to the environment </p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bashrc</span><br><span class="line">export JAVA_HOME=$(readlink -f /usr/bin/java | sed "s:bin/java::")</span><br></pre></td></tr></table></figure><p>If successful, the result should be like </p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo $JAVA_HOME</span><br><span class="line">/usr/lib/jvm/java-8-openjdk-amd64/jre/</span><br></pre></td></tr></table></figure><h3 id="Localhost"><a href="#Localhost" class="headerlink" title="Localhost"></a>Localhost</h3><p>Check the localhost file </p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/hosts</span><br></pre></td></tr></table></figure><p>and there should be a line for local ip address similar to </p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1   localhost</span><br></pre></td></tr></table></figure><h2 id="Nutch-Installation"><a href="#Nutch-Installation" class="headerlink" title="Nutch Installation"></a>Nutch Installation</h2><p>Download a binary package of Apache Nutch version 1.15 from Apache Archives (<a href="https://archive.apache.org/dist/nutch/1.15/)\" target="_blank" rel="noopener">https://archive.apache.org/dist/nutch/1.15/)\</a><br>Unzip the package and get the folder apache-nutch-1.15/<br>To verify the installation, run command line </p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd apache-nutch-1.15/</span><br><span class="line">bin/nutch</span><br></pre></td></tr></table></figure><p>the result should be similar to </p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">nutch 1.15</span><br><span class="line">Usage: nutch COMMAND</span><br><span class="line">where COMMAND is one of:</span><br><span class="line">  readdb            read / dump crawl db</span><br><span class="line">  mergedb           merge crawldb-s, with optional filtering</span><br><span class="line">  readlinkdb        read / dump link db</span><br><span class="line">  inject            inject new urls into the database</span><br><span class="line">  generate          generate new segments to fetch from crawl db</span><br><span class="line">  freegen           generate new segments to fetch from text files</span><br><span class="line">  fetch             fetch a segment's pages</span><br><span class="line">  parse             parse a segment's pages</span><br><span class="line">  readseg           read / dump segment data</span><br><span class="line">  mergesegs         merge several segments, with optional filtering and slicing</span><br><span class="line">  updatedb          update crawl db from segments after fetching</span><br><span class="line">  invertlinks       create a linkdb from parsed segments</span><br><span class="line">  mergelinkdb       merge linkdb-s, with optional filtering</span><br><span class="line">  index             run the plugin-based indexer on parsed segments and linkdb</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/images/nutch-02.jpg" alt=""></p><h2 id="Solr-Setup"><a href="#Solr-Setup" class="headerlink" title="Solr Setup"></a>Solr Setup</h2><h3 id="Download"><a href="#Download" class="headerlink" title="Download"></a>Download</h3><p>Download a binary package of Apache Solr version 7.3.1 from Apache Archives (<a href="https://archive.apache.org/dist/lucene/solr/7.3.1/)\" target="_blank" rel="noopener">https://archive.apache.org/dist/lucene/solr/7.3.1/)\</a><br>Unzip the package and get the folder solr-7.3.1/<br>Download corresponding Nutch schema from <a href="https://raw.githubusercontent.com/apache/nutch/master/src/plugin/indexer-solr/schema.xml" target="_blank" rel="noopener">https://raw.githubusercontent.com/apache/nutch/master/src/plugin/indexer-solr/schema.xml</a></p><h3 id="Set-Solr-Core"><a href="#Set-Solr-Core" class="headerlink" title="Set Solr Core"></a>Set Solr Core</h3><p>Create resources for a new Solr core nutch </p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd solr-7.3.1/</span><br><span class="line">mkdir -p server/solr/configsets/nutch/</span><br></pre></td></tr></table></figure><p>Copy the downloaded schema to core nutch configuration (instead of the schema directly from downloaded Nutch package, otherwise occurs fieldType “pdates” error) </p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp ../../Downloads/schema.xml server/solr/configsets/nutch/conf/</span><br></pre></td></tr></table></figure><p>Delete the schema template </p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm server/solr/configsets/nutch/conf/managed-schema</span><br></pre></td></tr></table></figure><p>Start Solr server </p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/solr start</span><br></pre></td></tr></table></figure><p>Create Solr core nutch </p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/solr create -c nutch -d server/solr/configsets/nutch/conf/</span><br></pre></td></tr></table></figure><p>Test the server by launching <a href="http://localhost:8983/solr/#/\" target="_blank" rel="noopener">http://localhost:8983/solr/#/\</a><br>Stop Solr server (after the crawling and searching) </p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/solr stop</span><br></pre></td></tr></table></figure><h3 id="Nutch-Integration"><a href="#Nutch-Integration" class="headerlink" title="Nutch Integration"></a>Nutch Integration</h3><p>The index writer configuration file for Nutch version 1.15 is conf/index-writers.xml in which the format and meta data can be modified<br><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/images/nutch-03.jpg" alt=""></p><h2 id="Crawl-Setup"><a href="#Crawl-Setup" class="headerlink" title="Crawl Setup"></a>Crawl Setup</h2><h3 id="Crawl-Property"><a href="#Crawl-Property" class="headerlink" title="Crawl Property"></a>Crawl Property</h3><p>Default crawl properties is set in conf/nutch-default.xml which defines properties for file, http, plugin and so on<br>Custom crawl properties can be set in conf/nutch-site.xml and there are two must-have properties to set </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Put site-specific property overrides in this file. --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- HTTP properties --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>http.agent.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>Nutch<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- plugin properties --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>plugin.includes<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>protocol-http|urlfilter-(regex|validator)|parse-(html|tika)|index-(basic|anchor)|indexer-solr|scoring-opic|urlnormalizer-(pass|regex|basic)<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>The indexer-solr is a must in plugin.includes property which is the default setting in conf/nutch-default.xml</p><h3 id="Seed-URLs"><a href="#Seed-URLs" class="headerlink" title="Seed URLs"></a>Seed URLs</h3><p>Create a URL seed list file by </p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd apache-nutch-1.15/</span><br><span class="line">mkdir -p urls</span><br><span class="line">cd urls</span><br><span class="line">touch seed.txt</span><br></pre></td></tr></table></figure><p>One URL per line for each site to crawl and it is important to design the seed list to avoid unnecessary pages and reduce crawling time<br>For example, if the crawling target is the list of professors and students major in computer science, the seed list can be chosen from faculty and student pages of universities </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.cc.gatech.edu&#x2F;people&#x2F;faculty</span><br><span class="line">https:&#x2F;&#x2F;www.cc.gatech.edu&#x2F;people&#x2F;phd</span><br><span class="line">https:&#x2F;&#x2F;cse.engin.umich.edu&#x2F;people&#x2F;faculty&#x2F;</span><br><span class="line">https:&#x2F;&#x2F;cse.engin.umich.edu&#x2F;people&#x2F;phd-students&#x2F;</span><br></pre></td></tr></table></figure><p>Regular Expression Filters can be configured in conf/regex-urlfilter.txt to limit the crawling range</p><h2 id="Crawling"><a href="#Crawling" class="headerlink" title="Crawling"></a>Crawling</h2><h3 id="Crawl-Database"><a href="#Crawl-Database" class="headerlink" title="Crawl Database"></a>Crawl Database</h3><p>Databases are used in crawling to store fetched information and the URL queue<br>Crawl database (crawldb) is provided by Nutch to store URL information obtained by Nutch (seeded or fetched) including the status and the time fetched<br>Link database (linkdb) is provided by Nutch to store the links to each URL including the source URL and the anchor text of each link<br>External databases can also be integrated to Nutch but need to configure<br>Before fetching URLs, insert the seed list to initiate crawldb </p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/nutch inject crawl/crawldb urls</span><br></pre></td></tr></table></figure><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/images/nutch-04.jpg" alt=""></p><h3 id="Fetching"><a href="#Fetching" class="headerlink" title="Fetching"></a>Fetching</h3><p>First generate a fetch list (URL queue) from the database </p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/nutch generate crawl/crawldb crawl/segments</span><br></pre></td></tr></table></figure><p>The list will be placed in a newly created segment directory names by the timestamp when it is created<br>Create the abbreviation of the most recent fetch list to make the later expression simple </p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s1=`ls -d crawl/segments/2* | tail -1`</span><br><span class="line">echo $s1</span><br></pre></td></tr></table></figure><p>Run the fetcher on the segment </p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/nutch fetch $s1</span><br></pre></td></tr></table></figure><p>The fetching time will depend on the length of the URL list and the number of links in each URL<br>Parse the entries after fetching </p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/nutch parse $s1</span><br></pre></td></tr></table></figure><p>Update the database with the results of the fetch </p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/nutch updatedb crawl/crawldb $s1</span><br></pre></td></tr></table></figure><p>After the first round fetching, the database contains both the initial pages and the newly discovered pages linked to the seed URLs so that a second round fetching can be further processed<br>Number of top-scoring pages can be chosen when generating the fetching list by the flag -topN </p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/nutch generate crawl/crawldb crawl/segments -topN 1000</span><br></pre></td></tr></table></figure><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/images/nutch-05.jpg" alt=""></p><h3 id="Indexing"><a href="#Indexing" class="headerlink" title="Indexing"></a>Indexing</h3><p>Invert all of the links </p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/nutch invertlinks crawl/linkdb -dir crawl/segments</span><br></pre></td></tr></table></figure><p>Index all the resources by Solr (use index instead of solrindex which is deprecated) </p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/nutch index crawl/crawldb/ -linkdb crawl/linkdb/ -dir crawl/segments -filter -normalize -deleteGone</span><br></pre></td></tr></table></figure><p>There are more options for the index command but may not be applied </p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Usage: Indexer (&lt;crawldb&gt; | -nocrawldb) (&lt;segment&gt; ... | -dir &lt;segments&gt;) [general options]</span><br></pre></td></tr></table></figure><p>Usually deleting duplication is necessary when indexing, but Solr will handle it automatically </p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Usage: bin/nutch dedup &lt;crawldb&gt; [-group &lt;none|host|domain&gt;] [-compareOrder &lt;score&gt;,&lt;fetchTime&gt;,&lt;httpsOverHttp&gt;,&lt;urlLength&gt;]</span><br></pre></td></tr></table></figure><p>After done searching, clean Solr to maintain a healthier quality of index </p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/nutch clean crawl/crawldb/</span><br></pre></td></tr></table></figure><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/images/nutch-06.jpg" alt=""></p><h3 id="Script"><a href="#Script" class="headerlink" title="Script"></a>Script</h3><p>Crawl script is provide by Nutch to allow more options and parameter modification for crawling, but it may not be so useful in crawling a small number of URLs when step-by-step operation and monitor are necessary </p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Usage: crawl [options] &lt;crawl_dir&gt; &lt;num_rounds&gt;</span><br><span class="line"></span><br><span class="line">Arguments:</span><br><span class="line">  &lt;crawl_dir&gt;                           Directory where the crawl/host/link/segments dirs are saved</span><br><span class="line">  &lt;num_rounds&gt;                          The number of rounds to run this crawl for</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -i|--index                            Indexes crawl results into a configured indexer</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h2 id="Searching"><a href="#Searching" class="headerlink" title="Searching"></a>Searching</h2><p>After crawling and indexing, launch Solr quey console (<a href="http://localhost:8983/solr/#/nutch/query)\" target="_blank" rel="noopener">http://localhost:8983/solr/#/nutch/query)\</a><br>Text queries in the q block using key-value pairs, for example, search pages with key word “system” in “content” </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">content:system</span><br></pre></td></tr></table></figure><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/images/nutch-07.jpg" alt=""><br>Searching range and other query parameters can be set with provided options</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://cwiki.apache.org/confluence/display/NUTCH/NutchTutorial" target="_blank" rel="noopener">https://cwiki.apache.org/confluence/display/NUTCH/NutchTutorial</a></li><li><a href="https://cwiki.apache.org/confluence/display/NUTCH/IndexWriters" target="_blank" rel="noopener">https://cwiki.apache.org/confluence/display/NUTCH/IndexWriters</a></li><li><a href="https://lobster1234.github.io/2017/08/14/search-with-nutch-mongodb-solr/" target="_blank" rel="noopener">https://lobster1234.github.io/2017/08/14/search-with-nutch-mongodb-solr/</a></li></ul>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;</summary>
        
      
    
    
    
    <category term="project" scheme="http://yoursite.com/categories/project/"/>
    
    
  </entry>
  
</feed>
