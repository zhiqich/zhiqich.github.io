<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.8.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>
<meta name="description" content="Apache Nutch and Apache Solr are projects from Apache Lucene search engine. Nutch is an open source crawler which provides the Java library for crawling, indexing and database storage. Solr is an open">
<meta property="og:type" content="article">
<meta property="og:title" content="Apache Nutch &amp; Solr">
<meta property="og:url" content="http://example.com/2021/01/31/apachenutch/index.html">
<meta property="og:site_name" content="Zhiqi Chen">
<meta property="og:description" content="Apache Nutch and Apache Solr are projects from Apache Lucene search engine. Nutch is an open source crawler which provides the Java library for crawling, indexing and database storage. Solr is an open">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/photo/nutch-01.jpg">
<meta property="og:image" content="http://example.com/photo/nutch-02.jpg">
<meta property="og:image" content="http://example.com/photo/nutch-03.jpg">
<meta property="og:image" content="http://example.com/photo/nutch-04.jpg">
<meta property="og:image" content="http://example.com/photo/nutch-05.jpg">
<meta property="og:image" content="http://example.com/photo/nutch-06.jpg">
<meta property="og:image" content="http://example.com/photo/nutch-07.jpg">
<meta property="article:published_time" content="2021-01-31T23:36:14.000Z">
<meta property="article:modified_time" content="2022-01-05T17:43:17.839Z">
<meta property="article:author" content="Zhiqi Chen">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/photo/nutch-01.jpg">


<link rel="canonical" href="http://example.com/2021/01/31/apachenutch/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://example.com/2021/01/31/apachenutch/","path":"2021/01/31/apachenutch/","title":"Apache Nutch & Solr"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Apache Nutch & Solr | Zhiqi Chen</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Zhiqi Chen</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Story</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
        <li class="menu-item menu-item-travel"><a href="/categories/travel/" rel="section"><i class="fa fa-map fa-fw"></i>travel</a></li>
        <li class="menu-item menu-item-game"><a href="/categories/game/" rel="section"><i class="fa fa-gamepad fa-fw"></i>game</a></li>
        <li class="menu-item menu-item-project"><a href="/categories/project/" rel="section"><i class="fa fa-code fa-fw"></i>project</a></li>
        <li class="menu-item menu-item-caprice"><a href="/categories/caprice/" rel="section"><i class="fa fa-music fa-fw"></i>caprice</a></li>
        <li class="menu-item menu-item-raving"><a href="/categories/raving/" rel="section"><i class="fa fa-leaf fa-fw"></i>raving</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Environment-Setup"><span class="nav-number">1.</span> <span class="nav-text">Environment Setup</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Operating-System"><span class="nav-number">1.1.</span> <span class="nav-text">Operating System</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Java"><span class="nav-number">1.2.</span> <span class="nav-text">Java</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Localhost"><span class="nav-number">1.3.</span> <span class="nav-text">Localhost</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Nutch-Installation"><span class="nav-number">2.</span> <span class="nav-text">Nutch Installation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Solr-Setup"><span class="nav-number">3.</span> <span class="nav-text">Solr Setup</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Download"><span class="nav-number">3.1.</span> <span class="nav-text">Download</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Set-Solr-Core"><span class="nav-number">3.2.</span> <span class="nav-text">Set Solr Core</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Nutch-Integration"><span class="nav-number">3.3.</span> <span class="nav-text">Nutch Integration</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Crawl-Setup"><span class="nav-number">4.</span> <span class="nav-text">Crawl Setup</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Crawl-Property"><span class="nav-number">4.1.</span> <span class="nav-text">Crawl Property</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Seed-URLs"><span class="nav-number">4.2.</span> <span class="nav-text">Seed URLs</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Crawling"><span class="nav-number">5.</span> <span class="nav-text">Crawling</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Crawl-Database"><span class="nav-number">5.1.</span> <span class="nav-text">Crawl Database</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Fetching"><span class="nav-number">5.2.</span> <span class="nav-text">Fetching</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Indexing"><span class="nav-number">5.3.</span> <span class="nav-text">Indexing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Script"><span class="nav-number">5.4.</span> <span class="nav-text">Script</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Searching"><span class="nav-number">6.</span> <span class="nav-text">Searching</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Reference"><span class="nav-number">7.</span> <span class="nav-text">Reference</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Zhiqi Chen</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">43</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">categories</span>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/zhiqich" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zhiqich" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:abraxas.zhiqich@gmail.com" title="E-Mail → mailto:abraxas.zhiqich@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/01/31/apachenutch/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhiqi Chen">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhiqi Chen">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Apache Nutch & Solr
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-01-31 18:36:14" itemprop="dateCreated datePublished" datetime="2021-01-31T18:36:14-05:00">2021-01-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-01-05 12:43:17" itemprop="dateModified" datetime="2022-01-05T12:43:17-05:00">2022-01-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/project/" itemprop="url" rel="index"><span itemprop="name">project</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>Apache Nutch and Apache Solr are projects from Apache Lucene search engine. Nutch is an open source crawler which provides the Java library for crawling, indexing and database storage. Solr is an open source search platform which provides full-text search and integration with Nutch. The following contents are steps of setting up Nutch and Solr for crawling and searching.</p>
<h2 id="Environment-Setup"><a href="#Environment-Setup" class="headerlink" title="Environment Setup"></a>Environment Setup</h2><h3 id="Operating-System"><a href="#Operating-System" class="headerlink" title="Operating System"></a>Operating System</h3><p>Ubuntu 20.04.1 64bit running on VMware with 4 cores and 8GB memory<br><img src="/photo/nutch-01.jpg"></p>
<h3 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h3><p>Java Runtime/Development Environment is JDK 1.8/Java 8<br>Installed by command line </p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install openjdk-8-jdk</span><br></pre></td></tr></table></figure>
<p>Installation can be checked by </p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -version</span><br></pre></td></tr></table></figure>
<p>and the result in command line should be </p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openjdk version &quot;1.8.0_275&quot;</span><br><span class="line">OpenJDK Runtime Environment (build 1.8.0_275-8u275-b01-0ubuntu1~20.04-b01)</span><br><span class="line">OpenJDK 64-Bit Server VM (build 25.275-b01, mixed mode)</span><br></pre></td></tr></table></figure>
<p>After installation, add the JAVA_HOME parameter to the environment </p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bashrc</span><br><span class="line">export JAVA_HOME=$(readlink -f /usr/bin/java | sed &quot;s:bin/java::&quot;)</span><br></pre></td></tr></table></figure>
<p>If successful, the result should be like </p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo $JAVA_HOME</span><br><span class="line">/usr/lib/jvm/java-8-openjdk-amd64/jre/</span><br></pre></td></tr></table></figure>
<h3 id="Localhost"><a href="#Localhost" class="headerlink" title="Localhost"></a>Localhost</h3><p>Check the localhost file </p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/hosts</span><br></pre></td></tr></table></figure>
<p>and there should be a line for local ip address similar to </p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1   localhost</span><br></pre></td></tr></table></figure>
<h2 id="Nutch-Installation"><a href="#Nutch-Installation" class="headerlink" title="Nutch Installation"></a>Nutch Installation</h2><p>Download a binary package of Apache Nutch version 1.15 from Apache Archives (<a target="_blank" rel="noopener" href="https://archive.apache.org/dist/nutch/1.15/)/">https://archive.apache.org/dist/nutch/1.15/)\</a><br>Unzip the package and get the folder apache-nutch-1.15/<br>To verify the installation, run command line </p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd apache-nutch-1.15/</span><br><span class="line">bin/nutch</span><br></pre></td></tr></table></figure>
<p>the result should be similar to </p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">nutch 1.15</span><br><span class="line">Usage: nutch COMMAND</span><br><span class="line">where COMMAND is one of:</span><br><span class="line">  readdb            read / dump crawl db</span><br><span class="line">  mergedb           merge crawldb-s, with optional filtering</span><br><span class="line">  readlinkdb        read / dump link db</span><br><span class="line">  inject            inject new urls into the database</span><br><span class="line">  generate          generate new segments to fetch from crawl db</span><br><span class="line">  freegen           generate new segments to fetch from text files</span><br><span class="line">  fetch             fetch a segment&#x27;s pages</span><br><span class="line">  parse             parse a segment&#x27;s pages</span><br><span class="line">  readseg           read / dump segment data</span><br><span class="line">  mergesegs         merge several segments, with optional filtering and slicing</span><br><span class="line">  updatedb          update crawl db from segments after fetching</span><br><span class="line">  invertlinks       create a linkdb from parsed segments</span><br><span class="line">  mergelinkdb       merge linkdb-s, with optional filtering</span><br><span class="line">  index             run the plugin-based indexer on parsed segments and linkdb</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p><img src="/photo/nutch-02.jpg"></p>
<h2 id="Solr-Setup"><a href="#Solr-Setup" class="headerlink" title="Solr Setup"></a>Solr Setup</h2><h3 id="Download"><a href="#Download" class="headerlink" title="Download"></a>Download</h3><p>Download a binary package of Apache Solr version 7.3.1 from Apache Archives (<a target="_blank" rel="noopener" href="https://archive.apache.org/dist/lucene/solr/7.3.1/)/">https://archive.apache.org/dist/lucene/solr/7.3.1/)\</a><br>Unzip the package and get the folder solr-7.3.1/<br>Download corresponding Nutch schema from <a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/apache/nutch/master/src/plugin/indexer-solr/schema.xml">https://raw.githubusercontent.com/apache/nutch/master/src/plugin/indexer-solr/schema.xml</a></p>
<h3 id="Set-Solr-Core"><a href="#Set-Solr-Core" class="headerlink" title="Set Solr Core"></a>Set Solr Core</h3><p>Create resources for a new Solr core nutch </p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd solr-7.3.1/</span><br><span class="line">mkdir -p server/solr/configsets/nutch/</span><br></pre></td></tr></table></figure>
<p>Copy the downloaded schema to core nutch configuration (instead of the schema directly from downloaded Nutch package, otherwise occurs fieldType “pdates” error) </p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp ../../Downloads/schema.xml server/solr/configsets/nutch/conf/</span><br></pre></td></tr></table></figure>
<p>Delete the schema template </p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm server/solr/configsets/nutch/conf/managed-schema</span><br></pre></td></tr></table></figure>
<p>Start Solr server </p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/solr start</span><br></pre></td></tr></table></figure>
<p>Create Solr core nutch </p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/solr create -c nutch -d server/solr/configsets/nutch/conf/</span><br></pre></td></tr></table></figure>
<p>Test the server by launching <a target="_blank" rel="noopener" href="http://localhost:8983/solr/#/\">http://localhost:8983/solr/#/\</a><br>Stop Solr server (after the crawling and searching) </p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/solr stop</span><br></pre></td></tr></table></figure>
<h3 id="Nutch-Integration"><a href="#Nutch-Integration" class="headerlink" title="Nutch Integration"></a>Nutch Integration</h3><p>The index writer configuration file for Nutch version 1.15 is conf/index-writers.xml in which the format and meta data can be modified<br><img src="/photo/nutch-03.jpg"></p>
<h2 id="Crawl-Setup"><a href="#Crawl-Setup" class="headerlink" title="Crawl Setup"></a>Crawl Setup</h2><h3 id="Crawl-Property"><a href="#Crawl-Property" class="headerlink" title="Crawl Property"></a>Crawl Property</h3><p>Default crawl properties is set in conf/nutch-default.xml which defines properties for file, http, plugin and so on<br>Custom crawl properties can be set in conf/nutch-site.xml and there are two must-have properties to set </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Put site-specific property overrides in this file. --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- HTTP properties --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>http.agent.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>Nutch<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- plugin properties --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>plugin.includes<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>protocol-http|urlfilter-(regex|validator)|parse-(html|tika)|index-(basic|anchor)|indexer-solr|scoring-opic|urlnormalizer-(pass|regex|basic)<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>The indexer-solr is a must in plugin.includes property which is the default setting in conf/nutch-default.xml</p>
<h3 id="Seed-URLs"><a href="#Seed-URLs" class="headerlink" title="Seed URLs"></a>Seed URLs</h3><p>Create a URL seed list file by </p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd apache-nutch-1.15/</span><br><span class="line">mkdir -p urls</span><br><span class="line">cd urls</span><br><span class="line">touch seed.txt</span><br></pre></td></tr></table></figure>
<p>One URL per line for each site to crawl and it is important to design the seed list to avoid unnecessary pages and reduce crawling time<br>For example, if the crawling target is the list of professors and students major in computer science, the seed list can be chosen from faculty and student pages of universities </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">https://www.cc.gatech.edu/people/faculty</span><br><span class="line">https://www.cc.gatech.edu/people/phd</span><br><span class="line">https://cse.engin.umich.edu/people/faculty/</span><br><span class="line">https://cse.engin.umich.edu/people/phd-students/</span><br></pre></td></tr></table></figure>
<p>Regular Expression Filters can be configured in conf/regex-urlfilter.txt to limit the crawling range</p>
<h2 id="Crawling"><a href="#Crawling" class="headerlink" title="Crawling"></a>Crawling</h2><h3 id="Crawl-Database"><a href="#Crawl-Database" class="headerlink" title="Crawl Database"></a>Crawl Database</h3><p>Databases are used in crawling to store fetched information and the URL queue<br>Crawl database (crawldb) is provided by Nutch to store URL information obtained by Nutch (seeded or fetched) including the status and the time fetched<br>Link database (linkdb) is provided by Nutch to store the links to each URL including the source URL and the anchor text of each link<br>External databases can also be integrated to Nutch but need to configure<br>Before fetching URLs, insert the seed list to initiate crawldb </p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/nutch inject crawl/crawldb urls</span><br></pre></td></tr></table></figure>
<p><img src="/photo/nutch-04.jpg"></p>
<h3 id="Fetching"><a href="#Fetching" class="headerlink" title="Fetching"></a>Fetching</h3><p>First generate a fetch list (URL queue) from the database </p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/nutch generate crawl/crawldb crawl/segments</span><br></pre></td></tr></table></figure>
<p>The list will be placed in a newly created segment directory names by the timestamp when it is created<br>Create the abbreviation of the most recent fetch list to make the later expression simple </p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s1=`ls -d crawl/segments/2* | tail -1`</span><br><span class="line">echo $s1</span><br></pre></td></tr></table></figure>
<p>Run the fetcher on the segment </p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/nutch fetch $s1</span><br></pre></td></tr></table></figure>
<p>The fetching time will depend on the length of the URL list and the number of links in each URL<br>Parse the entries after fetching </p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/nutch parse $s1</span><br></pre></td></tr></table></figure>
<p>Update the database with the results of the fetch </p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/nutch updatedb crawl/crawldb $s1</span><br></pre></td></tr></table></figure>
<p>After the first round fetching, the database contains both the initial pages and the newly discovered pages linked to the seed URLs so that a second round fetching can be further processed<br>Number of top-scoring pages can be chosen when generating the fetching list by the flag -topN </p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/nutch generate crawl/crawldb crawl/segments -topN 1000</span><br></pre></td></tr></table></figure>
<p><img src="/photo/nutch-05.jpg"></p>
<h3 id="Indexing"><a href="#Indexing" class="headerlink" title="Indexing"></a>Indexing</h3><p>Invert all of the links </p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/nutch invertlinks crawl/linkdb -dir crawl/segments</span><br></pre></td></tr></table></figure>
<p>Index all the resources by Solr (use index instead of solrindex which is deprecated) </p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/nutch index crawl/crawldb/ -linkdb crawl/linkdb/ -dir crawl/segments -filter -normalize -deleteGone</span><br></pre></td></tr></table></figure>
<p>There are more options for the index command but may not be applied </p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Usage: Indexer (&lt;crawldb&gt; | -nocrawldb) (&lt;segment&gt; ... | -dir &lt;segments&gt;) [general options]</span><br></pre></td></tr></table></figure>
<p>Usually deleting duplication is necessary when indexing, but Solr will handle it automatically </p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Usage: bin/nutch dedup &lt;crawldb&gt; [-group &lt;none|host|domain&gt;] [-compareOrder &lt;score&gt;,&lt;fetchTime&gt;,&lt;httpsOverHttp&gt;,&lt;urlLength&gt;]</span><br></pre></td></tr></table></figure>
<p>After done searching, clean Solr to maintain a healthier quality of index </p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/nutch clean crawl/crawldb/</span><br></pre></td></tr></table></figure>
<p><img src="/photo/nutch-06.jpg"></p>
<h3 id="Script"><a href="#Script" class="headerlink" title="Script"></a>Script</h3><p>Crawl script is provide by Nutch to allow more options and parameter modification for crawling, but it may not be so useful in crawling a small number of URLs when step-by-step operation and monitor are necessary </p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Usage: crawl [options] &lt;crawl_dir&gt; &lt;num_rounds&gt;</span><br><span class="line"></span><br><span class="line">Arguments:</span><br><span class="line">  &lt;crawl_dir&gt;                           Directory where the crawl/host/link/segments dirs are saved</span><br><span class="line">  &lt;num_rounds&gt;                          The number of rounds to run this crawl for</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -i|--index                            Indexes crawl results into a configured indexer</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h2 id="Searching"><a href="#Searching" class="headerlink" title="Searching"></a>Searching</h2><p>After crawling and indexing, launch Solr quey console (<a target="_blank" rel="noopener" href="http://localhost:8983/solr/#/nutch/query)\">http://localhost:8983/solr/#/nutch/query)\</a><br>Text queries in the q block using key-value pairs, for example, search pages with key word “system” in “content” </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">content:system</span><br></pre></td></tr></table></figure>
<p><img src="/photo/nutch-07.jpg"><br>Searching range and other query parameters can be set with provided options</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a target="_blank" rel="noopener" href="https://cwiki.apache.org/confluence/display/NUTCH/NutchTutorial">https://cwiki.apache.org/confluence/display/NUTCH/NutchTutorial</a></li>
<li><a target="_blank" rel="noopener" href="https://cwiki.apache.org/confluence/display/NUTCH/IndexWriters">https://cwiki.apache.org/confluence/display/NUTCH/IndexWriters</a></li>
<li><a target="_blank" rel="noopener" href="https://lobster1234.github.io/2017/08/14/search-with-nutch-mongodb-solr/">https://lobster1234.github.io/2017/08/14/search-with-nutch-mongodb-solr/</a></li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/01/20/7/" rel="prev" title="7">
                  <i class="fa fa-chevron-left"></i> 7
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/02/08/8/" rel="next" title="8">
                  8 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zhiqi Chen</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  



  <script src="/js/third-party/fancybox.js"></script>


  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
