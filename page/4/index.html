<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.8.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>
<meta property="og:type" content="website">
<meta property="og:title" content="Zhiqi Chen">
<meta property="og:url" content="http://example.com/page/4/index.html">
<meta property="og:site_name" content="Zhiqi Chen">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Zhiqi Chen">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/4/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/4/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Zhiqi Chen</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="stylesheet" href="/assets/css/APlayer.min.css" class="aplayer-style-marker">
<script src="/assets/js/APlayer.min.js" class="aplayer-script-marker"></script>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Zhiqi Chen</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Story</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
        <li class="menu-item menu-item-travel"><a href="/categories/travel/" rel="section"><i class="fa fa-map fa-fw"></i>travel</a></li>
        <li class="menu-item menu-item-game"><a href="/categories/game/" rel="section"><i class="fa fa-gamepad fa-fw"></i>game</a></li>
        <li class="menu-item menu-item-project"><a href="/categories/project/" rel="section"><i class="fa fa-code fa-fw"></i>project</a></li>
        <li class="menu-item menu-item-caprice"><a href="/categories/caprice/" rel="section"><i class="fa fa-music fa-fw"></i>caprice</a></li>
        <li class="menu-item menu-item-raving"><a href="/categories/raving/" rel="section"><i class="fa fa-leaf fa-fw"></i>raving</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Zhiqi Chen</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">43</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">categories</span>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/zhiqich" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zhiqich" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:abraxas.zhiqich@gmail.com" title="E-Mail → mailto:abraxas.zhiqich@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/07/25/automjerry/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhiqi Chen">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhiqi Chen">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/07/25/automjerry/" class="post-title-link" itemprop="url">AuTom and Jerry</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-07-25 20:54:29" itemprop="dateCreated datePublished" datetime="2020-07-25T20:54:29-04:00">2020-07-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-01-05 12:43:45" itemprop="dateModified" datetime="2022-01-05T12:43:45-05:00">2022-01-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/project/" itemprop="url" rel="index"><span itemprop="name">project</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <center><i><font color = gray>Autonomous Robot that Detects and Approaches Manually Controlled Mobile Agents</font></i></center>

<h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>The project is inspired by the “Push-Button Kitty” episode of Tom and Jerry. It’s a mobile intelligent robot system that can detect and follow targets in an unknown environment without collision.</p>
<iframe width="700" height="394" src="https://www.youtube-nocookie.com/embed/guo-HNbOSwk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<h3 id="Methodology"><a href="#Methodology" class="headerlink" title="Methodology"></a>Methodology</h3><p>The goal of the project is to autonomously identify, follow, and catch bugs in an unknown environment while avoiding obstacle collision with an MBot. Firstly, MBot needs a reliable method to find the bugs in real-time and calculate the pose of the bugs with computer vision. Secondly, the MBot needs to plan a safe path to the bug, which can be achieved with SLAM. Thirdly, the MBot needs to follow the bug and reduce the distance to it with vision tracking and PID controller. The following subsections discuss the approach to solving the individual tasks.</p>
<h4 id="Component-List"><a href="#Component-List" class="headerlink" title="Component List"></a>Component List</h4><p>The standard MBot on which the system is built has a Raspberry Pi, a Beaglebone, a lidar, a two-wheeled motor, and an on-board PiCam. Besides, in order to achieve the goal, two additional 720p cameras with 100 degree view need to be purchased to act as the replacement of PiCam to increase the detection range.</p>
<h4 id="Vision-Tracking"><a href="#Vision-Tracking" class="headerlink" title="Vision Tracking"></a>Vision Tracking</h4><p>AprilTags are applied to mark the bugs for real-time tracking. The on-board cameras can detect the AprilTags and calculate the poses of the bugs. The MBot can then transform the poses in the camera frame to the SLAM coordinate frame.</p>
<p><img src="/photo/autom-01.jpg"></p>
<h3 id="Motion-Planning"><a href="#Motion-Planning" class="headerlink" title="Motion Planning"></a>Motion Planning</h3><p>When the robot spots a bug and its corresponding AprilTag, it will generate a goal position for the robot to go to. The way the robot travels to that position will be determined via the A Star path planning algorithm. The algorithm uses the occupancy grid built up by SLAM to calculate the most cost-effective path to the target. Then the robot will move to the position with the help of a finely-tuned PID (Proportional Integral Derivative) controller.</p>
<p><img src="/photo/autom-02.jpg"></p>
<h3 id="Finite-State-Machine"><a href="#Finite-State-Machine" class="headerlink" title="Finite State Machine"></a>Finite State Machine</h3><p>Since the camera provides limited local frame of reference and the algorithm needs time to calculate the path, it’s necessary to develop a robust FSM for different states in the whole process. The first state should be looking for the target in the current camera frame. If the program detects the target, then it should enter the follow state and keep following it until the target is reached. If the moving target escapes the field of view, FSM will be switched and the robot will turn in the direction of the motion of the target or move to broaden the current view to search for it. When the target is detected again, the FSM will again enter the follow state.</p>
<p><img src="/photo/autom-03.jpg"></p>
<h3 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h3><iframe width="700" height="394" src="https://www.youtube-nocookie.com/embed/alckzV0rPlU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/07/23/letter/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhiqi Chen">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhiqi Chen">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/07/23/letter/" class="post-title-link" itemprop="url">Letter</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-07-23 01:40:15" itemprop="dateCreated datePublished" datetime="2020-07-23T01:40:15-04:00">2020-07-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-01-05 14:37:48" itemprop="dateModified" datetime="2022-01-05T14:37:48-05:00">2022-01-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/caprice/" itemprop="url" rel="index"><span itemprop="name">caprice</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>两天前看到好多人在朋友圈晒出网易云2020听歌报告，这才意识到新的一年又快到了。今年确实是很特殊的一年，也看到有同学写了年度总结，作为纪念。这篇文章大概是三个月前写好的，为的是记录在UM的两年对我来说重要或者有意义的事情。之前一直设置为加密，因为一些情绪更多是写给自己看的，算是给自己的一个答复。我觉得现在到了适当的时间了。2020年12月29日。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/07/23/letter/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/07/21/puertorico/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhiqi Chen">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhiqi Chen">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/07/21/puertorico/" class="post-title-link" itemprop="url">Puerto Rico</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-07-21 16:34:50" itemprop="dateCreated datePublished" datetime="2020-07-21T16:34:50-04:00">2020-07-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-01-05 14:05:12" itemprop="dateModified" datetime="2022-01-05T14:05:12-05:00">2022-01-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/travel/" itemprop="url" rel="index"><span itemprop="name">travel</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>波多黎各之行是在三月初，安娜堡最后一个春假。原本的计划是欧洲，心心念念的巴黎，可惜因为疫情的原因只能妥协，最终选择了一个温暖的地方看看海。四个月后回忆这次不成想的毕业旅行，还是很愉快的。</p>
<p><img src="/photo/puertorico-01.jpg"></p>
<p><img src="/photo/puertorico-02.jpg"></p>
<p>一下飞机就能感受到阳光，对于无法忍受安娜堡冬天的我来说简直是赐福。到了海边的住处，竟然有一间海景房（可惜猜拳输了没睡成），窗口就能吹到海风，出了院落的小门就是沙滩。于是放下行李，去海滩散步。踩着沙滩海水，不一会儿就把裤子弄湿了，海水、海风、落日余晖，都是温暖的。离住处不远有一栋满是涂鸦的房子，门口有一群小猫，应该有人家收养着，不怕生。圣胡安给了我不错的第一印象。</p>
<p><img src="/photo/puertorico-03.jpg"></p>
<p><img src="/photo/puertorico-04.jpg"></p>
<p>波多黎各的夜晚没有想象中热闹。原以为圣胡安旧城会多一些烟火气，可晚餐时间一过，街上行人就不多了，大概都回家休息了，有点日出而作日落而息的意思。带着小阳台的欧式建筑，隔着一条小道相对着，这种形制总是让我想到一些法语音乐剧，维罗纳、红与黑，要是哪个夹缝里藏了架梯子我也不会感到太奇怪。有那么几个场景和灯光有点墨西哥城宪法广场旁旧式公寓楼的味道，我还挺喜欢的。</p>
<p><img src="/photo/puertorico-05.jpg"></p>
<p><img src="/photo/puertorico-06.jpg"></p>
<p>海角城堡是个好玩儿的地方。从一处喷泉开始，沿着靠海的城墙走，有着几处超现实主义的雕塑，一转进城门又是旧城模样。窗台种着花花草草，小猫小狗树荫乘凉，彩色的墙壁就很适合当背景作头像。走上斜坡就是一大片绿色草坪，第一眼就像看到了微软经典桌面，躺倒晒太阳是真的舒服。城堡的四角都有造型别致的瞭望台，有点儿像古时候的灯座。在城堡的高处能一览整个海峡，海岸线、帆船、灯塔，别样风景。</p>
<p><img src="/photo/puertorico-07.jpg"></p>
<p><img src="/photo/puertorico-08.jpg"></p>
<p>不觉得波多黎各有什么特别好吃的，不过倒是有很不错的饮品。冲浪完来一杯piñacoladas，走进咖啡店点一杯frappes，热情的服务生和总是对不上姓名为上错单而害羞的女生，都是这座小岛真实的样子，连色彩都更鲜活了。若是有兴致，院落喝酒，唱歌夜谈，调一杯极其随意的mojito，用薄荷柠檬味雪碧兑当地的朗姆酒，也挺不错的。</p>
<p><img src="/photo/puertorico-09.jpg"></p>
<p><img src="/photo/puertorico-10.jpg"></p>
<p>这次旅行抽出了一天时间环岛自驾，一路看见沙滩就踩，看见礁石就登，走走停停算是拍了不少豪情壮志的大场面。沙滩上晒太阳的，打沙排的，海里戏水的，海角看海的，不得不说那里的居民真的很会享受生活。在一处沙滩遇到卖椰子的摊位，一人一个，开个小口插了吸管直接喝，甘甜。喝完剖开，用椰子皮刮了果肉吃，口感很好。不过我的还是太青了些，果肉只有薄薄的一层，半透明的，看着倒是很精致。</p>
<p><img src="/photo/puertorico-11.jpg"></p>
<p><img src="/photo/puertorico-12.jpg"></p>
<p>旅途中有两处景色让我很感动，反而不愿用相机记录下来。其一是荧光湖。划着船穿过小河道，夜晚船尾星星点点的灯串在一起，桨声水声，就这么蜿蜿蜒蜒地流向湖心。满月，最美的不是微微泛着蓝色荧光的湖水，而是夜空星辰。一抬头，觉得一切都暂时平静了下来。那时心里想着，如果可以一整晚都静静地躺在湖面上该有多好。现在回想起来，却是昨夜闲潭梦落花，可怜春半不还家。</p>
<p><img src="/photo/puertorico-13.jpg"></p>
<p><img src="/photo/puertorico-14.jpg"></p>
<p>其二是岛屿西南的海角。大概是人生中第一次看海角落日，却想到了很多人和事。坐在海角的岩石上，云意外得像自己曾想描绘的样子，耳机放着Mando Diao的歌单，那首瑞典古诗总是会在特别的时刻打动我。回来的路上特意换到了最后一排座位，想给自己一点空间，短暂逃避一会儿。晚上和朋友聊了很久很久，躺在沙发上睡着了，直到第二天早晨阳光洒进玻璃窗。</p>
<p><img src="/photo/puertorico-15.jpg"></p>
<p><img src="/photo/puertorico-16.jpg"></p>
<p>回程的飞机上睡得很香，睁开眼已经快到底特律了。同学提醒拉下遮光板，恰好是日落时分。天色和城市点亮的灯光相映，很美好的结尾。想了很久，还是决定分享一下这次的回忆，就当作是一份礼物了。</p>
<iframe width="700" height="394" src="https://www.youtube-nocookie.com/embed/RdzJfiYOiLc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/07/18/supervisorycontrol/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhiqi Chen">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhiqi Chen">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/07/18/supervisorycontrol/" class="post-title-link" itemprop="url">Supervisory Control under Local Mean Payoff Constraints</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-07-18 17:43:27" itemprop="dateCreated datePublished" datetime="2020-07-18T17:43:27-04:00">2020-07-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-01-05 12:46:36" itemprop="dateModified" datetime="2022-01-05T12:46:36-05:00">2022-01-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/project/" itemprop="url" rel="index"><span itemprop="name">project</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <center><i><font color = gray>Implementation of algorithms designed by Yiding Ji and Stéphane Lafortune</font></i></center>

<h3 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h3><p>The paper investigates quantitative supervisory control with a local mean payoff objective for weighted discrete event system. The supervisor is designed to ensure that the mean payoff of weights over a fixed number of transitions never drops below a given threshold, aka the system stability. The algorithms transfer the supervisory control problem to a biparty game between the supervisor and the environment.</p>
<h3 id="Automaton-Model"><a href="#Automaton-Model" class="headerlink" title="Automaton Model"></a>Automaton Model</h3><p>The weighted discrete event system can be modeled as an automaton. Here shows an example. The state with “!” is unsafe ($x_8$). The set of controllable events is $E_c=\{a,b,c,d,e,f\}$, and the set of uncontrollable events is $E_{uc}=\{u_1,u_2,u_3,u_4,u_5\}$. The localhost website gui is supported by the <em>WebMachine</em> from <em>transitions_gui</em> package.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">visualizeMachine</span>(<span class="params">states, transitions, initial, name, ordered_transitions=<span class="literal">False</span>, ignore_invalid_triggers=<span class="literal">True</span>, auto_transitions=<span class="literal">False</span></span>):</span></span><br><span class="line">    machine = WebMachine(states=states, transitions=transitions, initial=initial, name=name,</span><br><span class="line">                         ordered_transitions=ordered_transitions,</span><br><span class="line">                         ignore_invalid_triggers=ignore_invalid_triggers,</span><br><span class="line">                         auto_transitions=auto_transitions)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            time.sleep(<span class="number">5</span>)</span><br><span class="line">    <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">        machine.stop_server()</span><br></pre></td></tr></table></figure>

<p><img src="/photo/supervisory-control-01.jpg"></p>
<h3 id="Algorithm-1"><a href="#Algorithm-1" class="headerlink" title="Algorithm 1"></a>Algorithm 1</h3><p>The first algorithm is to transform the automaton model to a biparty game. It has two steps: insert transition states into the original automaton, and remove deadlocking or unsafe states. We can use DFS to find out all transitions, and generally the inserted transition states of one original state are the combination of all controllable events at that state plus the uncontrollable ones.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">DoDFS</span>(<span class="params">y, X, x0, f, Ec, Euc, w, Qy, Qz, G, fyz, fzy</span>):</span></span><br><span class="line">    gamma = []</span><br><span class="line">    tEuc = []</span><br><span class="line">    tEc = []</span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> f:</span><br><span class="line">        <span class="keyword">if</span> t[<span class="number">1</span>] == y:</span><br><span class="line">            <span class="keyword">if</span> t[<span class="number">0</span>] <span class="keyword">in</span> Euc:</span><br><span class="line">                tEuc.append(t[<span class="number">0</span>])</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                tEc.append(t[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(tEuc) == <span class="number">0</span> <span class="keyword">and</span> <span class="built_in">len</span>(tEc) == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(tEuc) != <span class="number">0</span> <span class="keyword">and</span> <span class="built_in">len</span>(tEc) == <span class="number">0</span>:</span><br><span class="line">        gamma.append(tEuc)</span><br><span class="line">        G.append(tEuc)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(tEuc) != <span class="number">0</span>:</span><br><span class="line">            gamma.append(tEuc)</span><br><span class="line">            G.append(tEuc)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(tEc) + <span class="number">1</span>):</span><br><span class="line">            l = <span class="built_in">list</span>(combinations(tEc, i))</span><br><span class="line">            <span class="keyword">for</span> r <span class="keyword">in</span> l:</span><br><span class="line">                gamma.append(<span class="built_in">list</span>(r) + tEuc)</span><br><span class="line">                G.append(<span class="built_in">list</span>(r) + tEuc)</span><br><span class="line">    <span class="keyword">for</span> g <span class="keyword">in</span> gamma:</span><br><span class="line">        z = [y] + g</span><br><span class="line">        fyz.append([g, y, z])</span><br><span class="line">        <span class="keyword">if</span> z <span class="keyword">not</span> <span class="keyword">in</span> Qz:</span><br><span class="line">            Qz.append(z)</span><br><span class="line">            <span class="keyword">for</span> e <span class="keyword">in</span> g:</span><br><span class="line">                yn = <span class="string">&#x27;&#x27;</span></span><br><span class="line">                <span class="keyword">for</span> t <span class="keyword">in</span> f:</span><br><span class="line">                    <span class="keyword">if</span> t[<span class="number">0</span>] == e <span class="keyword">and</span> t[<span class="number">1</span>] == y:</span><br><span class="line">                        yn = t[<span class="number">2</span>]</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">if</span> yn[<span class="number">0</span>] == <span class="string">&#x27;!&#x27;</span>:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                fzy.append([e, z, yn])</span><br><span class="line">                <span class="keyword">if</span> yn <span class="keyword">not</span> <span class="keyword">in</span> Qy:</span><br><span class="line">                    Qy.append(yn)</span><br><span class="line">                    DoDFS(yn, X, x0, f, Ec, Euc, w, Qy, Qz, G, fyz, fzy)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">removeUnsafe</span>(<span class="params">states, transitions</span>):</span></span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> states:</span><br><span class="line">        <span class="keyword">if</span> s[<span class="number">0</span>] == <span class="string">&#x27;!&#x27;</span>:</span><br><span class="line">            <span class="keyword">for</span> t <span class="keyword">in</span> transitions:</span><br><span class="line">                <span class="keyword">if</span> t[<span class="number">1</span>] == s <span class="keyword">or</span> t[<span class="number">2</span>] == s:</span><br><span class="line">                    transitions.remove(t)</span><br><span class="line">            states.remove(s)</span><br></pre></td></tr></table></figure>

<p><img src="/photo/supervisory-control-02.jpg"></p>
<h3 id="Algorithm-2"><a href="#Algorithm-2" class="headerlink" title="Algorithm 2"></a>Algorithm 2</h3><p>The second algorithm is to find the supervisor’s winning region. It first calculates the window mean payoff function which tracks the best worst-case accumulative weights that the supervisor may achieve from a state within N event occurrences (window size). Then the goal equivalents to adopting a control strategy to obtain a nonnegative accumulative payoff while the environment aims to spoil that goal by enforcing negative payoffs. We can use divide-and-conquer to find out all stable windows where the local window mean payoffs are all nonnegative. The example has a window size of three.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">StableWindow</span>(<span class="params">Qy, Qz, fyz, fzy, w, N</span>):</span></span><br><span class="line">    wgr = []</span><br><span class="line">    h = &#123;&#125;</span><br><span class="line">    h[<span class="number">0</span>] = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> q <span class="keyword">in</span> Qy + Qz:</span><br><span class="line">        h[<span class="number">0</span>][<span class="built_in">str</span>(q)] = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, N+<span class="number">1</span>):</span><br><span class="line">        h[i] = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> q <span class="keyword">in</span> Qz:</span><br><span class="line">            ey = [[element[<span class="number">0</span>], element[<span class="number">2</span>]]</span><br><span class="line">                  <span class="keyword">for</span> element <span class="keyword">in</span> fzy <span class="keyword">if</span> element[<span class="number">1</span>] == q <span class="keyword">and</span> element[<span class="number">2</span>] <span class="keyword">in</span> Qy]</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(ey) != <span class="number">0</span>:</span><br><span class="line">                ystates = []</span><br><span class="line">                <span class="keyword">for</span> y <span class="keyword">in</span> ey:</span><br><span class="line">                    <span class="keyword">if</span> <span class="built_in">str</span>(y[<span class="number">1</span>]) <span class="keyword">in</span> h[i - <span class="number">1</span>].keys():</span><br><span class="line">                        ystates.append(y)</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(ystates) != <span class="number">0</span>:</span><br><span class="line">                    h[i][<span class="built_in">str</span>(q)] = <span class="built_in">min</span>([w[t[<span class="number">0</span>]] + h[i - <span class="number">1</span>][<span class="built_in">str</span>(t[<span class="number">1</span>])]</span><br><span class="line">                                        <span class="keyword">for</span> t <span class="keyword">in</span> ystates])</span><br><span class="line">                    <span class="keyword">if</span> h[i][<span class="built_in">str</span>(q)] &gt;= <span class="number">0</span>:</span><br><span class="line">                        wgr.append(q)</span><br><span class="line">        <span class="keyword">for</span> q <span class="keyword">in</span> Qy:</span><br><span class="line">            ytz = [element[<span class="number">2</span>]</span><br><span class="line">                   <span class="keyword">for</span> element <span class="keyword">in</span> fyz <span class="keyword">if</span> element[<span class="number">1</span>] == q <span class="keyword">and</span> element[<span class="number">2</span>] <span class="keyword">in</span> Qz]</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(ytz) != <span class="number">0</span>:</span><br><span class="line">                zstates = []</span><br><span class="line">                <span class="keyword">for</span> z <span class="keyword">in</span> ytz:</span><br><span class="line">                    <span class="keyword">if</span> <span class="built_in">str</span>(z) <span class="keyword">in</span> h[i].keys():</span><br><span class="line">                        zstates.append(z)</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(zstates) != <span class="number">0</span>:</span><br><span class="line">                    h[i][<span class="built_in">str</span>(q)] = <span class="built_in">max</span>([h[i][<span class="built_in">str</span>(z)] <span class="keyword">for</span> z <span class="keyword">in</span> zstates])</span><br><span class="line">                    <span class="keyword">if</span> h[i][<span class="built_in">str</span>(q)] &gt;= <span class="number">0</span>:</span><br><span class="line">                        wgr.append(q)</span><br><span class="line">    wg = []</span><br><span class="line">    [wg.append(q) <span class="keyword">for</span> q <span class="keyword">in</span> wgr <span class="keyword">if</span> <span class="keyword">not</span> q <span class="keyword">in</span> wg]</span><br><span class="line">    <span class="keyword">return</span> wg</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">WinLocal</span>(<span class="params">Qy, Qz, fyz, fzy, w, N</span>):</span></span><br><span class="line">    wg = StableWindow(Qy, Qz, fyz, fzy, w, N)</span><br><span class="line">    wp = []</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(wg) == <span class="built_in">len</span>(Qy + Qz) <span class="keyword">or</span> <span class="built_in">len</span>(wg) == <span class="number">0</span>:</span><br><span class="line">        wp = wg</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        Qyn = []</span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> Qy:</span><br><span class="line">            <span class="keyword">if</span> y <span class="keyword">in</span> wg:</span><br><span class="line">                Qyn.append(y)</span><br><span class="line">        Qzn = []</span><br><span class="line">        <span class="keyword">for</span> z <span class="keyword">in</span> Qz:</span><br><span class="line">            <span class="keyword">if</span> z <span class="keyword">in</span> wg:</span><br><span class="line">                Qzn.append(z)</span><br><span class="line">        wp = WinLocal(Qyn, Qzn, fyz, fzy, w, N)</span><br><span class="line">    <span class="keyword">return</span> wp</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">attraction</span>(<span class="params">attr, s0, Q, f, wp</span>):</span></span><br><span class="line">    <span class="keyword">if</span> s0 <span class="keyword">in</span> wp:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        res = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> f:</span><br><span class="line">            <span class="keyword">if</span> i[<span class="number">1</span>] == s0:</span><br><span class="line">                res.append(attraction(attr, i[<span class="number">2</span>], Q, f, wp))</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">            <span class="keyword">if</span> i == <span class="literal">False</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        attr.append(s0)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">winRegion</span>(<span class="params">Qy, Qz, fyz, fzy, w, N, y0, wl</span>):</span></span><br><span class="line">    ws = []</span><br><span class="line">    n = <span class="number">1</span></span><br><span class="line">    Qyw = [y <span class="keyword">for</span> y <span class="keyword">in</span> Qy]</span><br><span class="line">    Qzw = [z <span class="keyword">for</span> z <span class="keyword">in</span> Qz]</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(ws) != <span class="built_in">len</span>(Qy + Qz):</span><br><span class="line">        wp = WinLocal(Qyw, Qzw, fyz, fzy, w, N)</span><br><span class="line">        wl += wp</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(wp) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        attrr = []</span><br><span class="line">        _ = attraction(attrr, y0, Qy + Qz, fzy + fyz, wp)</span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> wp + attrr:</span><br><span class="line">            <span class="keyword">if</span> p <span class="keyword">not</span> <span class="keyword">in</span> ws:</span><br><span class="line">                ws.append(p)</span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> Qyw:</span><br><span class="line">            <span class="keyword">if</span> y <span class="keyword">in</span> ws:</span><br><span class="line">                Qyw.remove(y)</span><br><span class="line">        <span class="keyword">for</span> z <span class="keyword">in</span> Qzw:</span><br><span class="line">            <span class="keyword">if</span> z <span class="keyword">in</span> ws:</span><br><span class="line">                Qzw.remove(z)</span><br><span class="line">        n += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> ws</span><br></pre></td></tr></table></figure>

<p><img src="/photo/supervisory-control-03.jpg"></p>
<h3 id="Algorithm-3"><a href="#Algorithm-3" class="headerlink" title="Algorithm 3"></a>Algorithm 3</h3><p>The third algorithm is to reconstruct and unfold the result of the second algorithm. It has two steps. The first one is to merge all stable windows in the second algorithm together, and add original states back to the automaton so that each original state has only one transit-out arrow. The second one is to remove all the inserted environment states to simplify the automaton and finally give a stable workflow.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Unfold</span>(<span class="params">y0u, Qyu, Qzu, fyzu, fzyu, Qy, Qz, fyz, fzy</span>):</span></span><br><span class="line">    duplicate = &#123;&#125;</span><br><span class="line">    lru = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> Qy:</span><br><span class="line">        duplicate[i] = <span class="number">1</span></span><br><span class="line">        lru[i] = <span class="number">0</span></span><br><span class="line">    state = y0u</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(Qzu) &lt; <span class="built_in">len</span>(Qz):</span><br><span class="line">        du = <span class="literal">False</span></span><br><span class="line">        sn = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> state <span class="keyword">in</span> Qyu:</span><br><span class="line">            <span class="keyword">if</span> duplicate[state] != <span class="number">1</span>:</span><br><span class="line">                du = <span class="literal">True</span></span><br><span class="line">                sn = <span class="string">&#x27;&#123;&#x27;</span>+state+<span class="string">&#x27;&#125;&#x27;</span>+<span class="built_in">str</span>(lru[state])</span><br><span class="line">                <span class="keyword">if</span> lru[state] != <span class="number">0</span>:</span><br><span class="line">                    Qyu.append(sn)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            Qyu.append(state)</span><br><span class="line">            d = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> fyz:</span><br><span class="line">                <span class="keyword">if</span> i[<span class="number">1</span>] == state:</span><br><span class="line">                    d += <span class="number">1</span></span><br><span class="line">            duplicate[state] = d</span><br><span class="line">        lru[state] = (lru[state] + <span class="number">1</span>) % duplicate[state]</span><br><span class="line">        temp = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> fyz:</span><br><span class="line">            <span class="keyword">if</span> i[<span class="number">1</span>] == state <span class="keyword">and</span> i[<span class="number">2</span>] <span class="keyword">not</span> <span class="keyword">in</span> Qzu:</span><br><span class="line">                temp.append(i)</span><br><span class="line">        z = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(temp) == <span class="number">1</span>:</span><br><span class="line">            z = temp[<span class="number">0</span>][<span class="number">2</span>]</span><br><span class="line">            Qzu.append(z)</span><br><span class="line">            <span class="keyword">if</span> du == <span class="literal">False</span>:</span><br><span class="line">                fyzu.append(temp[<span class="number">0</span>])</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                fyzu.append([temp[<span class="number">0</span>][<span class="number">0</span>], sn, z])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            t = [<span class="built_in">len</span>(i[<span class="number">2</span>]) <span class="keyword">for</span> i <span class="keyword">in</span> temp]</span><br><span class="line">            yz = temp[t.index(<span class="built_in">max</span>(t))]</span><br><span class="line">            z = yz[<span class="number">2</span>]</span><br><span class="line">            Qzu.append(z)</span><br><span class="line">            <span class="keyword">if</span> du == <span class="literal">False</span>:</span><br><span class="line">                fyzu.append(yz)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                fyzu.append([yz[<span class="number">0</span>], sn, z])</span><br><span class="line">        y = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> fzy:</span><br><span class="line">            <span class="keyword">if</span> i[<span class="number">1</span>] == z:</span><br><span class="line">                <span class="keyword">if</span> lru[i[<span class="number">2</span>]] == <span class="number">0</span>:</span><br><span class="line">                    fzyu.append(i)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    fzyu.append([i[<span class="number">0</span>], i[<span class="number">1</span>], <span class="string">&#x27;&#123;&#x27;</span>+i[<span class="number">2</span>]+<span class="string">&#x27;&#125;&#x27;</span>+<span class="built_in">str</span>(lru[i[<span class="number">2</span>]])])</span><br><span class="line">                y.append(i[<span class="number">2</span>])</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(y) == <span class="number">1</span>:</span><br><span class="line">            state = y[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            yin = []</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> y:</span><br><span class="line">                <span class="keyword">if</span> i <span class="keyword">not</span> <span class="keyword">in</span> Qyu:</span><br><span class="line">                    yin.append(i)</span><br><span class="line">            num = []</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(yin) == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> y:</span><br><span class="line">                    count = <span class="number">0</span></span><br><span class="line">                    <span class="keyword">for</span> j <span class="keyword">in</span> fzy:</span><br><span class="line">                        <span class="keyword">if</span> j[<span class="number">2</span>] == i:</span><br><span class="line">                            count += <span class="number">1</span></span><br><span class="line">                    num.append(count)</span><br><span class="line">                state = y[num.index(<span class="built_in">min</span>(num))]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> yin:</span><br><span class="line">                    count = <span class="number">0</span></span><br><span class="line">                    <span class="keyword">for</span> j <span class="keyword">in</span> fzy:</span><br><span class="line">                        <span class="keyword">if</span> j[<span class="number">2</span>] == i:</span><br><span class="line">                            count += <span class="number">1</span></span><br><span class="line">                    num.append(count)</span><br><span class="line">                state = y[num.index(<span class="built_in">min</span>(num))]</span><br></pre></td></tr></table></figure>

<p><img src="/photo/supervisory-control-04.jpg"></p>
<p><img src="/photo/supervisory-control-05.jpg"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/07/18/sjtucapstonedesign/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhiqi Chen">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhiqi Chen">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/07/18/sjtucapstonedesign/" class="post-title-link" itemprop="url">Control of Virtual and Real Manufacturing Systems in AR/VR</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-07-18 17:23:53" itemprop="dateCreated datePublished" datetime="2020-07-18T17:23:53-04:00">2020-07-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-01-05 12:46:05" itemprop="dateModified" datetime="2022-01-05T12:46:05-05:00">2022-01-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/project/" itemprop="url" rel="index"><span itemprop="name">project</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <center><i><font color = gray>Shanghai Jiao Tong University Capstone Design</font></i></center>

<h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>Imagine in this pandemic of Covid-19, some engineers have no access to manufacturing machines. Or, imagine we students want to learn to use some machines in the factory. How can we learn this online? So our motivation is to use virtual reality and augmented reality technology to synchronously show the manufacturing process and simulate the milling process.</p>
<p><img src="/photo/sjtucapstonedesign-01.jpg"></p>
<p>Before heading to the details, we first have a overview of our system. There are three main parts: user, transmission and machine. The remote users could control the machine by gesture and observe the machine with VR headset. The local user can use the mobile application to see a virtual workpiece rendered on the screen. The red arrow represents control signals input; while blue arrows are real-time feedbacks from the machine. Our system looks complicated at first sight, but it would be clear later.</p>
<p><img src="/photo/sjtucapstonedesign-02.jpg"></p>
<h3 id="Requirements-and-Concept-Generation"><a href="#Requirements-and-Concept-Generation" class="headerlink" title="Requirements and Concept Generation"></a>Requirements and Concept Generation</h3><p>In terms of needs, for VR part, users require real time synchronization, high degree of freedom, and immersive experience. For AR part, we need precisely positioning and carving. Particularly, a sample of AR effect is shown here. Users will scan the machine without materials to know how an artifact will be manufactured. It helps validate the correctness of manufacturing program without wasting materials. For both subfunctions, users need high portability, low financial cost and low learning cost.</p>
<p><img src="/photo/sjtucapstonedesign-03.jpg"></p>
<p>From the needs, we formulate some engineering specifications. We set refresh frequency and latency as the real time criteria and we also add the specifications for object deviation rate, financial cost and so on. The engineering specifications will affect our concept generation and selection.</p>
<p><img src="/photo/sjtucapstonedesign-04.jpg"></p>
<p>From the needs, we list out the necessary sub-functions we want to have and choose. We use weight matrices to carry out decision selection based on the engineering specifications. For the user side, we choose HTC Vive Pro as the headset for VR since it a commonly used VR headset with friendly handles and good user experience. We choose smartphones to be the AR terminal because that everyone can download an APP and access to the system. Unity 3D is chose to build the model since it can make and simulate vivid 3D model. For the transmission side, we choose socket connection to reduce the latency and raise the update frequency. Mysql is a stable and fast database that can transmit and store structured data in a short time. For the machine side, we choose Mach3 to control the CNC milling machine, the software can read the real time milling machine status in a low latency.</p>
<p><img src="/photo/sjtucapstonedesign-05.jpg"></p>
<h3 id="Design-Description"><a href="#Design-Description" class="headerlink" title="Design Description"></a>Design Description</h3><h4 id="VR-System"><a href="#VR-System" class="headerlink" title="VR System"></a>VR System</h4><p>Now let’s discuss about implementation details. For VR control system part, currently we have implemented environment to enable user to control CNC machine manually to start, move and stop virtually. Also, user may choose to load precompiled Gcode Program to show simulation result of a model. We use Unity Package SteamVR and VRTK to build up the VR environment. Then we setup the control panel by Csharp scripts in Unity which sends user’s commands to MySQL database while simulating CNC machine with data feedback from database.</p>
<p><img src="/photo/sjtucapstonedesign-06.jpg"></p>
<h4 id="Real-time-Simulation"><a href="#Real-time-Simulation" class="headerlink" title="Real-time Simulation"></a>Real-time Simulation</h4><p>For real-time simulation, we create a brand new algorithm with several Csharp scripts to simulate real time cutting effect of CNC machine in Unity. Below displays actual effect of two controlling methods. In Unity, the program would first generate enough mesh vertices on surface of the piece. Then, whenever the cutter contacts with the vertices, the vertices will modify its height to display cutting effect. This algorithm ensures real-time connection between devices.</p>
<p><img src="/photo/sjtucapstonedesign-07.jpg"></p>
<p><img src="/photo/sjtucapstonedesign-08.jpg"></p>
<h4 id="AR-System"><a href="#AR-System" class="headerlink" title="AR System"></a>AR System</h4><p>Most parts of the AR environment is a migration from VR. Besides, we utilize vuforia tools to build the AR visualization. We designed the image target to stable the model, which we’ll show later in the demo. Also, we seperate the 3D calculation and the AR visualization to make the whole program run smoothly.</p>
<p><img src="/photo/sjtucapstonedesign-09.jpg"></p>
<h3 id="Prototype"><a href="#Prototype" class="headerlink" title="Prototype"></a>Prototype</h3><h4 id="VR-System-1"><a href="#VR-System-1" class="headerlink" title="VR System"></a>VR System</h4><p>The VR system is built up by three parts: from left to right, remote client, MySQL server and Mach3 client. In the remote client, we built a unity model which is divided into four parts: the base and x, y, z axis. The scale of the coordinate and the directions of the axis are consistent with the real machine. Therefore, given the real-world coordinate, the model will visualize the machine correctly. The Mach3 client is a relay between MySQL server and Mach3. It receives commands from sql and sends to Mach3 and also receives coordinates from Mach3 and sends to sql. MySQL then is a data storage for remote communication. The desktop running Mach3 and Mach3 client is connected to the real machine to operate.</p>
<p><img src="/photo/sjtucapstonedesign-10.jpg"></p>
<h4 id="Real-time-Simulation-1"><a href="#Real-time-Simulation-1" class="headerlink" title="Real-time Simulation"></a>Real-time Simulation</h4><p>For the real-time transmission, we have two parts. First, the Mach3 client will create connection to the MySQL database and query the data in every loop, which is more than 30Hz, so that once there’s new command (such as “Load” or “Stop”) sent to the database, the client can get it immediately. The second part is the socket transmission. Once the client queries the new command data, it will send it through the socket channel to Mach3. In the meantime, Mach3 VB script will always listen to the socket port, and if there’s any data in the socket channel buffer, it will run sockRead to get the command. With our prototype, the whole transmission process is in real-time.</p>
<p><img src="/photo/sjtucapstonedesign-11.jpg"></p>
<h4 id="AR-System-1"><a href="#AR-System-1" class="headerlink" title="AR System"></a>AR System</h4><p>For the AR, the visualization is similar to VR, but it has a different database connection method and a new tag recognition task. Due to mobile security issue, both android and ios don’t allow direct connection to online database. So we wrote a php website on the google cloud platform app engine. It directly connects to the database and opens a web api which is a query to the position data so that on the mobile platform, our program can utilize webrequest package to request the api url to get the data through html form. About the tag recognition, we designed a tag which has a lot of geometric features. The round SJTU logo can help locate the center and the color blocks on the margin have character points which help Vuforia engine determine the direction.</p>
<p><img src="/photo/sjtucapstonedesign-12.jpg"></p>
<h3 id="Results"><a href="#Results" class="headerlink" title="Results"></a>Results</h3><h4 id="VR-Demo"><a href="#VR-Demo" class="headerlink" title="VR Demo"></a>VR Demo</h4><p>In the video, the right-hand-side is the laptop running our VR model, and on the left is the real cutting process. We can click buttons or use VR device to remote control Mach3 client which is connected to the real physical machine. And the Mach3 client will send back position and moving information back to VR model for visualization. We can see the latency is very low, and it is due to the internet connection and low computing power of the old lab desktop.</p>
<iframe width="700" height="394" src="https://www.youtube-nocookie.com/embed/GnndIw2oZjg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<h4 id="AR-Demo"><a href="#AR-Demo" class="headerlink" title="AR Demo"></a>AR Demo</h4><p>Here is the AR APP running on the iOS platform. We can either pre-load our JI cutting model into database or run the Gcode in real-time, and the AR APP can visualize it.</p>
<iframe width="700" height="394" src="https://www.youtube-nocookie.com/embed/nJrR-TTfSw4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<h3 id="Discussion-and-Conclusions"><a href="#Discussion-and-Conclusions" class="headerlink" title="Discussion and Conclusions"></a>Discussion and Conclusions</h3><h4 id="Quantitative-experiments"><a href="#Quantitative-experiments" class="headerlink" title="Quantitative experiments"></a>Quantitative experiments</h4><p>After finishing the prototype, we conducted some experiments for validation. Using the network tool Wireshark, we calculated the frequency of the position feedback, which is around 20 packets per second. At the same time, on the RHS the round-trip time graph shows that the latency is around 50ms, which is lower than our expectation 200ms.</p>
<p><img src="/photo/sjtucapstonedesign-13.jpg"></p>
<h4 id="Pros-and-Cons"><a href="#Pros-and-Cons" class="headerlink" title="Pros and Cons"></a>Pros and Cons</h4><p>Our system enables remote and real-time simulation. Those who are thousands miles away from the machine can still have access to the control and feedback. The database storage enables the users to recap their Gcode programs. However, due to the hardware setting limit, our computer cannot afford greater amount of calculations for higher precision. If we need to simulate a sophisticated artifact, our current design may not give precise enough outcomes.</p>
<p><img src="/photo/sjtucapstonedesign-14.jpg"></p>
<h4 id="What-if"><a href="#What-if" class="headerlink" title="What-if"></a>What-if</h4><p>Reviewing our design, we found many aspects that we could’ve done better. The first point is computer hardware. Since our CNC Milling machine can only support Windows 7 32bit, it later became our performance bottleneck. If we could start over, we should pay more attention to the choice of hardware. Also, we expect that in the future, AR can adapt itself to the nested mobile device.</p>
<h4 id="Conclusions"><a href="#Conclusions" class="headerlink" title="Conclusions"></a>Conclusions</h4><p>In summary, we are dedicated to a remote, real-time control system. Our design used socket connection and MySQL database to record position parameters. We also designed a new shader algorithm for workpiece simulation. In general, our design meets most of the requirements. The server establishment and shader algorithm are the two most important achievements. During this pandemic, we witnessed the power of remote teamwork, and the importance of time management. We are excited and grateful to be a part of this wonderful journey.</p>
<p><a target="_blank" rel="noopener" href="https://drive.google.com/file/d/1ld2cZ6i5nljHevpbQcafOv1ESgQj428J/view?usp=sharing">Presentation Slides</a></p>
<p><a target="_blank" rel="noopener" href="https://drive.google.com/file/d/1TCHT4oJmlwYBkmM4SWfCA3eZiQa6z50N/view?usp=sharing">Thesis Report</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/zhiqich/VE450">GitHub Repo</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/07/11/octopathtraveler/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhiqi Chen">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhiqi Chen">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/07/11/octopathtraveler/" class="post-title-link" itemprop="url">Octopath Traveler</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-07-11 19:03:23" itemprop="dateCreated datePublished" datetime="2020-07-11T19:03:23-04:00">2020-07-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-01-05 21:33:39" itemprop="dateModified" datetime="2022-01-05T21:33:39-05:00">2022-01-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/game/" itemprop="url" rel="index"><span itemprop="name">game</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>既然不是那么严肃的个人主页，我也会介绍一些喜欢的游戏，音乐和书籍。这次聊一聊歧路旅人，可以说是第一个让我感到惊艳的游戏。当时看了游戏的预告瞬间被精致的画风震撼到，类型和小时候在同学家玩儿的最终幻想有些类似，但光影效果地图细节好了太多太多，可以说是被迷住了，直接下了数字版，完全等不了卡带版本的物流时间。</p>
<p><img src="/photo/octopath-traveler-02.jpg"></p>

        <div id="aplayer-GBRzkYCB" class="aplayer aplayer-tag-marker" style="margin-bottom: 20px;">
            <pre class="aplayer-lrc-content"></pre>
        </div>
        <script>
          var ap = new APlayer({
            element: document.getElementById("aplayer-GBRzkYCB"),
            narrow: false,
            autoplay: false,
            showlrc: false,
            music: {
              title: "Octopath Traveler - Main Theme",
              author: "Yasunori Nishiki",
              url: "/music/Octopath Traveler - Main Theme.mp3",
              pic: "/photo/octopath-traveler-01.jpg",
              lrc: ""
            }
          });
          window.aplayers || (window.aplayers = []);
          window.aplayers.push(ap);
        </script>

<p>游戏开始毫不犹豫就选了舞娘作为初始角色，纯粹是因为舞娘的立绘太漂亮了，过于美好以至于让我对旅人这个词产生了形象上的冲突，更加好奇旅途中会有怎样的故事发生。但当我开始舞娘的故事线，听到主题的瞬间，才真正明白为什么歧路旅人会让这么多玩家感动。沙漠中金色的小镇，美丽的舞娘，如此契合的主题。即便结局未知，已然心醉。</p>
<p><img src="/photo/octopath-traveler-03.jpg"></p>

        <div id="aplayer-KsYdVrnG" class="aplayer aplayer-tag-marker" style="margin-bottom: 20px;">
            <pre class="aplayer-lrc-content"></pre>
        </div>
        <script>
          var ap = new APlayer({
            element: document.getElementById("aplayer-KsYdVrnG"),
            narrow: false,
            autoplay: false,
            showlrc: false,
            music: {
              title: "Primrose, The Dancer",
              author: "Yasunori Nishiki",
              url: "/music/Primrose, The Dancer.mp3",
              pic: "/photo/octopath-traveler-01.jpg",
              lrc: ""
            }
          });
          window.aplayers || (window.aplayers = []);
          window.aplayers.push(ap);
        </script>

<p>除了每个角色的主题外，地图上不同的地区也会有不一样的主题音乐。其中我最喜欢的是崖地主题，第一次注意到是在盗贼离开Bolderfall启程寻找龙石的时候。长笛（其实有一点像尺八）的声音真的很适合表现旅途的漫长，以至于途经崖地时常驻足。</p>

        <div id="aplayer-eSrkdhdX" class="aplayer aplayer-tag-marker" style="margin-bottom: 20px;">
            <pre class="aplayer-lrc-content"></pre>
        </div>
        <script>
          var ap = new APlayer({
            element: document.getElementById("aplayer-eSrkdhdX"),
            narrow: false,
            autoplay: false,
            showlrc: false,
            music: {
              title: "The Cliftlands",
              author: "Yasunori Nishiki",
              url: "/music/The Cliftlands.mp3",
              pic: "/photo/octopath-traveler-01.jpg",
              lrc: ""
            }
          });
          window.aplayers || (window.aplayers = []);
          window.aplayers.push(ap);
        </script>

<p>兜兜转转，走完了八条主线，完成了所有的支线任务，甚至听完了所有酒馆中的对话，回过头来串起整个故事，无限感慨。每个故事线的结尾都会有一张角色绘图，我都一一截图保存了下来，每一个角色都有了新的生活，但我始终觉得舞娘的结局有些遗憾。七位旅人启程时有人送，归来时有人迎，唯独舞娘一个人寻找旅程的意义。</p>
<p><img src="/photo/octopath-traveler-04.jpg"></p>

        <div id="aplayer-RIjidUnb" class="aplayer aplayer-tag-marker" style="margin-bottom: 20px;">
            <pre class="aplayer-lrc-content"></pre>
        </div>
        <script>
          var ap = new APlayer({
            element: document.getElementById("aplayer-RIjidUnb"),
            narrow: false,
            autoplay: false,
            showlrc: false,
            music: {
              title: "Primrose Motif",
              author: "Yasunori Nishiki",
              url: "/music/Primrose Motif.mp3",
              pic: "/photo/octopath-traveler-01.jpg",
              lrc: ""
            }
          });
          window.aplayers || (window.aplayers = []);
          window.aplayers.push(ap);
        </script>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/07/07/lozdungeon/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhiqi Chen">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhiqi Chen">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/07/07/lozdungeon/" class="post-title-link" itemprop="url">LoZ Dungeon</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-07-07 20:33:10" itemprop="dateCreated datePublished" datetime="2020-07-07T20:33:10-04:00">2020-07-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-01-05 21:32:40" itemprop="dateModified" datetime="2022-01-05T21:32:40-05:00">2022-01-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/game/" itemprop="url" rel="index"><span itemprop="name">game</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>花了三个星期的时间重制了塞尔达传说地牢关。为了尽可能地复制原版本的细节，把这一关卡玩儿了有上百遍，以至于经典BGM都要听厌了，甚至上手了红白机，体验旧手柄特有的触感。在野炊时代回看初代塞尔达，仍旧非常耐玩，也算是我的入坑之作了。</p>
<p><img src="/photo/lozdungeon-01.jpg"></p>
<p><img src="/photo/lozdungeon-02.jpg"></p>
<p>既然是自己重制的第一个游戏，那么除了游戏截图和过程视频外，准备多讲一些制作细节。首先是环境。虽然是一个2D游戏，但由于墙壁、障碍物和水之类的游戏元素都有层次上的区别，以及游戏转场过程中相机的移动，把环境设置为3D会更容易制作。只需点亮2D视角，无论是canvas还是游戏主界面都和2D游戏的制作没什么区别。</p>
<p><img src="/photo/lozdungeon-03.jpg"></p>
<p><img src="/photo/lozdungeon-04.jpg"></p>
<p>其次是collider和trigger以及rigidbody的设置，这是最最头疼的。比如说武器与怪物的接触和林克和怪物的接触就需要不同的接触机制，这样才能做出原版的击打效果。人物和障碍物为了防止穿模的情况发生，都会加上rigidbody性质，同时为了减少碰撞对速度的影响，在每次接触检测后都需要重置一下速度。甚至相同的物体在不同的情况下接触条件都会有所区别，比如在受到伤害后的冷却时间内，林克与怪物的碰撞检测会被取消以免受到重复伤害。这些可能会需要设置许多tag和layer去逐个设置碰撞条件。</p>
<p><img src="/photo/lozdungeon-05.jpg"></p>
<p><img src="/photo/lozdungeon-06.jpg"></p>
<p>所有的怪物中，猪是最难实现的，因为他本身会使用武器。除了继承骷髅和蝙蝠的随机移动之外，还需要去考虑掷出回旋镖的情况。回旋镖的最大投掷距离有多远，如果在中途触碰围墙该如何判定，回旋镖触碰怪物和触碰林克的区别，甚至需要考虑在投掷过程中猪被杀死的情况。这些大多是由collider和trigger的判定去实现的。</p>
<p><img src="/photo/lozdungeon-07.jpg"></p>
<p><img src="/photo/lozdungeon-08.jpg"></p>
<p>原以为一款像素风的老游戏不会太精细，但真正上手之后才发现好多细节没有想的那么简单。比如说人物行走，看似只要根据上下左右的按键给出移动距离，但因为地图是由正方形格子拼成的，而为了营造3D的效果，人物的collider其实是小于半格的，这样一来就需要在每次移动时将人物的横纵坐标近似到固定的几条纵横线上以达到走格子的效果。再比如剑的远程攻击的实现，在剑飞行的过程中其实林克依然可以挥剑的，也可以朝另一个方向投掷，只是不允许同时朝一个方向投掷多把剑。这样一来可能就需要创建五把剑：手持一把，另外四个方向隐藏四把，在需要的时候设置可见。另外还有一些击退效果和免疫效果需要去思考。</p>
<p><img src="/photo/lozdungeon-09.jpg"></p>
<p><img src="/photo/lozdungeon-10.jpg"></p>
<p>除了原版的地图和怪物之外，自己另外设计了两个小房间，算是开了脑洞了。第一个房间国际象棋的设计有两个灵感来源：一是地图的格子很像棋盘，二是哈利波特的巫师棋。于是就想着把白棋作为怪物，林克需要扮演一枚黑子去赢下这局，而棋盘外摆放的棋子提示了林克扮演的是城堡。林克只有走到checkmate的位置才会触发游戏机关。如果是哈迷可能会发现残局的摆放其实是密室那一局的小改动，效果还是挺有趣的。第二个房间制作得比较随意，就想换个风格，结果吓到了试玩的同学。房间的红色地砖如果踩踏的时间久了就会对林克造成伤害。只有杀死所有红蝙蝠才能拿到通关的钥匙。在视频里最后不小心死了，就没能拿到。希望玩家会喜欢这两个小设计。</p>
<p><img src="/photo/lozdungeon-11.jpg"></p>
<p><img src="/photo/lozdungeon-12.jpg"></p>
<iframe width="700" height="394" src="https://www.youtube-nocookie.com/embed/9bt2tokPW4Y" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<p><a target="_blank" rel="noopener" href="https://drive.google.com/file/d/1VqD-FlRWVHiH-Db_wBifOUtTaUjRwgoO/view?usp=sharing">Download macOS</a></p>
<p><a target="_blank" rel="noopener" href="https://drive.google.com/file/d/1F1SJFH9Q3tbfThD_JVyY1iQ7CunRhH1j/view?usp=sharing">Download Windows</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/07/07/thegoldrush/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhiqi Chen">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhiqi Chen">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/07/07/thegoldrush/" class="post-title-link" itemprop="url">The Gold Rush</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-07-07 17:07:39" itemprop="dateCreated datePublished" datetime="2020-07-07T17:07:39-04:00">2020-07-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-01-05 21:35:17" itemprop="dateModified" datetime="2022-01-05T21:35:17-05:00">2022-01-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/game/" itemprop="url" rel="index"><span itemprop="name">game</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>It’s in the game</p>
<p>Years ago, in the middle-earth…</p>
<p>Warrior waves the sword<br>Thief steals from others<br>Witch shoots fireballs<br>Bomberman drops bombs</p>
<p>The four elites cooperate and compete with each other to collect golds from a newly found gold mine</p>
<p>Want to join? Follow The Gold Rush<br>Presented by Godzilli</p>
<iframe width="700" height="394" src="https://www.youtube-nocookie.com/embed/r0kIejfs4gw" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<!-- [Download macOS](https://drive.google.com/file/d/15_XmPLqTpVu8NAN8_Pm3MlQHKlMGzXer/view?usp=sharing) -->

<p><a target="_blank" rel="noopener" href="https://drive.google.com/file/d/1JnN1xxgXxLyc9FU02UAGUi7hJ9IsyT_b/view?usp=sharing">Download Windows</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/07/05/castalia/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhiqi Chen">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhiqi Chen">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/07/05/castalia/" class="post-title-link" itemprop="url">Castalia</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-07-05 12:44:54" itemprop="dateCreated datePublished" datetime="2020-07-05T12:44:54-04:00">2020-07-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-01-05 21:31:35" itemprop="dateModified" datetime="2022-01-05T21:31:35-05:00">2022-01-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/game/" itemprop="url" rel="index"><span itemprop="name">game</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <center><i><font color = gray>
"No permanence is ours; we are a wave<br>
That flows to fit whatever form it finds:<br>
Through night or day, cathedral or the cave<br>
We pass forever, craving form that binds."<br>
-- Hermann Hesse, Das Glasperlenspiel
</font></i></center>

<p>A game prototype I created within one week, inspired by the book Das Glasperlenspiel. In the game, players can step on the lights to control the movement of various parts to form the path to the end. The designed view change will help players solve the puzzle. Enjoy.</p>
<p><img src="/photo/castalia-01.jpg"></p>
<p><img src="/photo/castalia-02.jpg"></p>
<p><img src="/photo/castalia-03.jpg"></p>
<p><img src="/photo/castalia-04.jpg"></p>
<p><a target="_blank" rel="noopener" href="https://drive.google.com/file/d/1kssTcYxCHkpurp_n0MYWgZ4qhg9giojz/view?usp=sharing">Download macOS</a></p>
<p><a target="_blank" rel="noopener" href="https://drive.google.com/file/d/1q25y-5lgmtdhl7g3CIASR58jvBdEnBUP/view?usp=sharing">Download Windows</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/07/03/calw/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhiqi Chen">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhiqi Chen">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/07/03/calw/" class="post-title-link" itemprop="url">Calw</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-07-03 16:55:12" itemprop="dateCreated datePublished" datetime="2020-07-03T16:55:12-04:00">2020-07-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-01-05 14:08:59" itemprop="dateModified" datetime="2022-01-05T14:08:59-05:00">2022-01-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/caprice/" itemprop="url" rel="index"><span itemprop="name">caprice</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Calw是德国的一个小镇，也是我最喜爱的作家黑塞的故乡。原是想借着这地名和黑塞书中所感写一两首严肃一些的配乐的，但周遭的变故让我改变了想法。那时对于被困家中还有些许新鲜感，好像突然多了很多自我的时间可以翻翻书，看看电影，听听音乐。于是乎偶然地重温了《挪威的森林》，电影里的插曲也成了循环播放的歌单，夜晚散步的好陪伴。</p>

        <div id="aplayer-fpXwskJm" class="aplayer aplayer-tag-marker" style="margin-bottom: 20px;">
            <pre class="aplayer-lrc-content"></pre>
        </div>
        <script>
          var ap = new APlayer({
            element: document.getElementById("aplayer-fpXwskJm"),
            narrow: false,
            autoplay: false,
            showlrc: false,
            music: {
              title: "Calw",
              author: "Zhiqi Chen",
              url: "/music/Calw.wav",
              pic: "",
              lrc: ""
            }
          });
          window.aplayers || (window.aplayers = []);
          window.aplayers.push(ap);
        </script>

<p>不过说起来，可能都是因为一张明信片吧，来自Goteborg一个晴朗的五月天，一年后再次翻看竟有些恍惚了，我一时不知该怎么称呼她。烟火气和牛肉汤的香味，旧书店，是想象中的模样，却又有些小诙谐。于是就凭着感觉写下了这两小段音乐，盼着有一天可以独自旅行走过老城广场，希望再次相见不必等太久。</p>

        <div id="aplayer-BHlQJiig" class="aplayer aplayer-tag-marker" style="margin-bottom: 20px;">
            <pre class="aplayer-lrc-content"></pre>
        </div>
        <script>
          var ap = new APlayer({
            element: document.getElementById("aplayer-BHlQJiig"),
            narrow: false,
            autoplay: false,
            showlrc: false,
            music: {
              title: "Tavern",
              author: "Zhiqi Chen",
              url: "/music/Tavern.wav",
              pic: "",
              lrc: ""
            }
          });
          window.aplayers || (window.aplayers = []);
          window.aplayers.push(ap);
        </script>

<p>我讨厌安娜堡的冬天，尤其是下雪的日子，从房间窗口看出去只有被雪压着的枯枝和一堵不好看的红墙，颜色深一些或淡一些都会好很多，可惜了。记得在这里的第一年冬，天天祈求天公作美，大概是没那闲情逸致喝酒赏雪吧。不知是不是因为习惯了寒冷，自觉今年的冬天过得快，本以为是好事，现在想来还不如白茫茫一片落得平静自在。</p>
<p>得知奶奶过世的消息是在傍晚太阳落山的时候，我一个人在Northwood散步。奶奶听不大懂普通话，所以每次打电话我都说得很慢，说得很响，这样她就能明白我的意思了，这样她就会开心。可还是因为时间和地域的缘故，距离拉近又疏远。每次回老家都觉得自己像是个客人，生分了拘谨了，但有些东西心里是再清楚不过的。</p>
<p>这一次是我失约了。哥哥的婚礼，朋友的聚会，说好了的事情。可别怪我呀，我也无能为力，我也很累。</p>

        <div id="aplayer-cvpJQkKS" class="aplayer aplayer-tag-marker" style="margin-bottom: 20px;">
            <pre class="aplayer-lrc-content"></pre>
        </div>
        <script>
          var ap = new APlayer({
            element: document.getElementById("aplayer-cvpJQkKS"),
            narrow: false,
            autoplay: false,
            showlrc: false,
            music: {
              title: "Goteborg",
              author: "Zhiqi Chen",
              url: "/music/Goteborg.wav",
              pic: "",
              lrc: ""
            }
          });
          window.aplayers || (window.aplayers = []);
          window.aplayers.push(ap);
        </script>

<p>希望在故事的结尾还会有做梦的机会。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zhiqi Chen</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  



  <script src="/js/third-party/fancybox.js"></script>


  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
